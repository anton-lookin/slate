<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>NimbleCommerce API / iOS SDK / Android SDK References</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell","objective_c","java"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">Shell</a>
              <a href="#" data-language-name="objective_c">iOS</a>
              <a href="#" data-language-name="java">Android</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://www.nimblecommerce.com'>Copyright Â© 2015 Nimblecommerce</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the NimbleCommerce ecosystem! Here you can find references for API which will give you access to NimbleCommerce platform via programmatic interface.</p>

<p>We have language bindings in Shell, Objective-C for iOS, and Java for Android! You can view code examples in the dark area to the right, and you can switch the programming language of the examples with the tabs in the top right.</p>

<h1 id="nimblecommerce-api">NimbleCommerce API</h1>

          <h2 id="change-log">Change Log</h2>

<p>Updated August 14, 2015</p>

<h3 id="api-version-7">API version 7</h3>

<ul>
<li>Sales tax support for Shopping Cart</li>
<li>Shipping support for online/offline coupons</li>
<li>Order vouchers statuses support added</li>
</ul>

          <h2 id="description">Description</h2>

<p>NimbleCommerce API provides a set of programmatic interfaces that give you access to manipulate with platform data.
We work hard under our API and trying to implement modern approaches for it. NimbleCommerce API is mostly a RESTful API based on HTTP requests with JSON responses. 
Current version of NimbleCommerce API is <em>7</em>. 
Current version uses 1-step auth scheme to authorize and authenticate platform users, more information you can find under Authorization scheme of our documentation.</p>

          <h2 id="errors">Errors</h2>

<p>The NimbleCommerce API uses HTTP response codes to handle requests results for most of API calls. API uses the following HTTP response codes to indicate request execution result.</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; The request could not be understood by the server due to malformed syntax.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; The request requires user authentication. The response MUST include a Authorization header field with valid authorization token.</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The request was a legal request, but the server is refusing to respond to it. Error code for user not authorized to perform the operation or the resource is unavailable for some reason.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The server has not found anything matching the Request-URI.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; The method specified in the Request-Line is not allowed for the resource identified by the Request-URI.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; The resource identified by the request is only capable of generating response entities which have content characteristics not acceptable according to the accept headers sent in the request.</td>
</tr>
<tr>
<td>410</td>
<td>Gone &ndash; The requested resource is no longer available at the server and no forwarding address is known.</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>502</td>
<td>Bad Gateway &ndash; The server was acting as a gateway or proxy and received an invalid response from the upstream server.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later.</td>
</tr>
</tbody></table>

<aside class="notice">
However there are a number of outdated API methods that return result in `status` field of response json. Generally this methods will return status 200 to indicate success and 500 to indicate that error happened.
</aside>

          <h1 id="authorization">Authorization</h1>

<p>NimbleCommerce use custom authentication/authorization scheme which is similar to Basic HTTP Authentication. The process is simple enough, to authorize and authenticate user do a secure call over https on /api/authorization with credentials or facebook data. You get authorization token which should be passed with requests that requires user authorization/authentication. Authorization token should be placed in HTTP request with <code class="prettyprint">Authorization</code> header name. Server application will extract and validate user identity from request automatically.</p>

<p><strong>iOS</strong></p>

<p><code class="prettyprint">NCAuthorizationManager usage is recommended way to embed user authorization in your application</code></p>

<p><code class="prettyprint">NCAuthorizationManager</code> will automatically handle all authorization routines credentials saving, tokens caching and renewal.</p>

<p><code class="prettyprint">Authorization token and user credentials securely saved in keychain</code></p>

<p>NimbleCommerce SDK gives ability to build your own authorization handling. You should use <code class="prettyprint">NCAuthorization</code> loader to get you authorization token.</p>

<p>To handle result you should register for notifications defined in <code class="prettyprint">NCAuthorizationManager.h</code>. 
<code class="prettyprint">NCAuthorizationManagerAuthorizationCompleted</code> - notification fired when user authorization succeed.
<code class="prettyprint">NCAuthorizationManagerAuthorizationFailed</code> - notification fired when user authorization failed for some reason, error code can be found in notification&rsquo;s userInfo by &lsquo;kNCAuthorizationErrorCode&rsquo; key.
<code class="prettyprint">NCAuthorizationManagerDeauthorizationCompleted</code> - notification fired when user deautorization succeed.</p>

<p><strong>Android</strong></p>

<p><code class="prettyprint">AuthManager</code> usage is recommended way to embed user authorization in your application`</p>

<p><code class="prettyprint">NCAuthorizationManager</code> will automatically handle all authorization routines credentials saving, tokens caching and renewal.</p>

<p><code class="prettyprint">Authorization token and user credentials securely saved in secured preferences</code></p>

<p>Be sure to call &#39;authorize&rsquo; method inside async context, <code class="prettyprint">authorize()</code> is sync method and can throw number of exception, you should handle this manually.
<code class="prettyprint">AuthManager</code> fires couple of local notifications, so you could catch result in different parts of your application.
<code class="prettyprint">LOGIN_EVENT</code> - notification fired when user authorization succeed.
<code class="prettyprint">LOGOUT_EVENT</code> - notification fired when user deauthorization succeed.
<code class="prettyprint">SIGN_UP_EVENT</code> - notification fired when user registration succeed.</p>

<aside class="notice">
Make sure to replace `Authorization Token` with your Authorization Token for all requests that require authorization. If you use managers than this handlings will be done automatically.
</aside>

<h2 id="authorization-with-credentials">Authorization with Credentials</h2>

<p>Received <code class="prettyprint">Authorization Token</code> has limited lifetime but long enough to not mess with reauthorization while application running. 
It is recommended to update token when your application start.</p>

<aside class="notice">
Be sure to do all the secure requests over `https` protocol.
</aside>

<blockquote>
<p>Performs user authorization by login and password.</p>
</blockquote>
<pre class="highlight objective_c"><code><span class="cp">#import &lt;NimbleCommerceSDK/NCAuthorizationManager.h&gt;
</span>
<span class="p">[[</span><span class="n">NCAuthorizationManager</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">authorizeWithEmail</span><span class="p">:</span><span class="n">email</span> <span class="nf">password</span><span class="p">:</span><span class="n">password</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code><span class="kn">import</span> <span class="nn">gb.android.sdk.Nmb</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">gb.android.sdk.managers.AuthManager</span><span class="o">;</span>

<span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">authorize</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"email={USER_EMAIL}&amp;password={USER_PASSWORD}"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 6"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/authorize?merchantId<span class="o">=</span>78
</code></pre>

<h2 id="authorization-with-facebook">Authorization with Facebook</h2>

<p>You should setup application for facebook sign in, receive user data and fill <code class="prettyprint">facebookData</code> bean.
<aside class="notice">
Note, email is mandatory field, so you should setup permission on your facebook application.
</aside></p>

<blockquote>
<p>Performs user authorization with Facebook account.</p>
</blockquote>
<pre class="highlight objective_c"><code><span class="cp">#import &lt;NimbleCommerceSDK/NCAuthorizationManager.h&gt;
</span>
<span class="p">[[</span><span class="n">NCAuthorizationManager</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">authorizeWithFacebook</span><span class="p">:</span><span class="n">facebookData</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code><span class="kn">import</span> <span class="nn">gb.android.sdk.Nmb</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">gb.android.sdk.managers.AuthManager</span><span class="o">;</span>

<span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">authorize</span><span class="o">(</span><span class="n">facebookUserBean</span><span class="o">,</span> <span class="n">mFacebook</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">(),</span> <span class="n">birthDate</span><span class="o">);</span>
</code></pre>

          <h1 id="loading-deals">Loading Deals</h1>

<p>You can load various deals list by calling <code class="prettyprint">/api/groupBuyMerchantList</code> with set of parameters. 
This call does not require to have authenticated user to proceed. </p>

<h3 id="parameters-description">Parameters description:</h3>

<p>Parameters should be passed as GET request parametes in URL. <code class="prettyprint">merchantId</code>, <code class="prettyprint">localeId</code> and <code class="prettyprint">categoryId</code> are mandatory parameters and all other are optional.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>merchantId</td>
<td>number</td>
<td>merchant identifier</td>
</tr>
<tr>
<td>localeId</td>
<td>number</td>
<td>locale site identifier</td>
</tr>
<tr>
<td>categoryId</td>
<td>number</td>
<td>category (city) identifier</td>
</tr>
<tr>
<td>page</td>
<td>number</td>
<td>list page to load, will check for maxResults to calculate valid list offset</td>
</tr>
<tr>
<td>maxResults</td>
<td>number</td>
<td>size of list page</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>comma separated string with deal types</td>
</tr>
<tr>
<td>filter</td>
<td>string</td>
<td>comma separated string with deal statuses or custom filter string</td>
</tr>
<tr>
<td>sort</td>
<td>string</td>
<td>comma separated string with deal sort constants</td>
</tr>
<tr>
<td>latitude</td>
<td>number</td>
<td>location latitude</td>
</tr>
<tr>
<td>longitude</td>
<td>number</td>
<td>location longitude</td>
</tr>
<tr>
<td>tags</td>
<td>string</td>
<td>comma separated tags (categories) identifiers</td>
</tr>
</tbody></table>

<p>Deal types constants:
Constant | Description
&mdash;&mdash;&mdash; | &mdash;&mdash;&mdash;&ndash;
d | paid deals
c | contests
s | store offers
m | membership deals
a | affiliate deals
t | travel deals
all | all deals</p>

<p>Deal status constants:
Constant | Description
&mdash;&mdash;&mdash; | &mdash;&mdash;&mdash;&ndash;
l | live deals
c | closed deals
t | tipped deals
p | pending deals
e | expired deals
s | sold out deals
lt | live and tipped deals
lnt | live and not tipped deals
ct | closed and tippded deals
cnt | closed and not tipped deals</p>

<p>Deal sorts constants:
Suffix _asc or _desc should be added to sort parameters to proceed.
Constant | Description
&mdash;&mdash;&mdash; | &mdash;&mdash;&mdash;&ndash;
sortField | sort by sort filed
distance | sort by distance
dealName | sort by deal name
published | sort by publish date
time | sort by expiration time
numberDealSold | sort by sold products count
stdCityName | sort by standart city name</p>

<blockquote>
<p>Loading deals list</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="c1">// Create loader and keep strong reference on it
</span>    <span class="n">self</span><span class="p">.</span><span class="n">loader</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCDealsList</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="c1">// Assign loader delegate to handle loading result
</span>    <span class="n">self</span><span class="p">.</span><span class="n">loader</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="c1">// Aggregate pararameters in special bean
</span>    <span class="n">NCDealListParameters</span> <span class="o">*</span><span class="n">params</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCDealListParameters</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">params</span><span class="p">.</span><span class="n">categoryId</span> <span class="o">=</span> <span class="mi">@25221</span><span class="p">;</span>
    <span class="n">params</span><span class="p">.</span><span class="n">page</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">params</span><span class="p">.</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">params</span><span class="p">.</span><span class="n">types</span> <span class="o">=</span> <span class="s">@"d,c,a"</span><span class="p">;</span> <span class="c1">// paid deals, contests and affiliates
</span>    <span class="n">params</span><span class="p">.</span><span class="n">filters</span> <span class="o">=</span> <span class="s">@"l,e"</span><span class="p">;</span> <span class="c1">// load live and expired deals
</span>    <span class="p">[</span><span class="n">params</span><span class="p">.</span><span class="n">sorts</span> <span class="nf">addSort</span><span class="p">:</span><span class="s">@"published_desc"</span><span class="p">]</span> <span class="c1">// add sorting parameter 
</span>    <span class="n">params</span><span class="p">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">@[];</span> <span class="c1">// array of tags to filter with
</span>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loader</span> <span class="nf">getDeals</span><span class="p">:</span><span class="n">params</span><span class="p">];</span>

    <span class="c1">// Handle loading success in delegated method
</span>    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">dealsListingSucceed</span><span class="p">:(</span><span class="n">NCDealsList</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="c1">// Handle loading failure in delegated method
</span>    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">dealsListingFailed</span><span class="p">:(</span><span class="n">NCDealsList</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="nf">withError</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span> <span class="p">{</span>
    <span class="p">}</span>
</code></pre>
<pre class="highlight java"><code>    <span class="c1">// Create parameter builder for deals loader</span>
    <span class="n">Params</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Params</span><span class="o">.</span><span class="na">Builder</span><span class="o">().</span><span class="na">fromArgs</span><span class="o">(</span><span class="n">getArguments</span><span class="o">());</span>
    <span class="n">builder</span><span class="o">.</span><span class="na">page</span><span class="o">(</span><span class="n">mCurrentPage</span><span class="o">).</span><span class="na">size</span><span class="o">(</span><span class="mi">10</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="n">Constants</span><span class="o">.</span><span class="na">Sort</span><span class="o">.</span><span class="na">SORT_FIELD_DESC</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="n">Constants</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">LIVE</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="n">Constants</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">deals</span><span class="o">());</span>

    <span class="kd">final</span> <span class="n">Deals</span> <span class="n">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Deals</span><span class="o">(</span><span class="n">getActivity</span><span class="o">());</span>
    <span class="c1">// Save reference on a loader</span>
    <span class="k">this</span><span class="o">.</span><span class="na">loader</span> <span class="o">=</span> <span class="n">loader</span><span class="o">;</span>
    <span class="n">loader</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">())</span>
            <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">Deals</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">GroupBuyList</span> <span class="n">dealsList</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// Handle loading success</span>
                <span class="o">}</span>

                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// Handle loading failure</span>
                <span class="o">}</span>
            <span class="o">}).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X GET <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    <span class="s2">"http://stage.nimblebuy.com/api/groupBuyMerchantList?merchantId=78&amp;localeId=281&amp;categoryId=25221&amp;page=0&amp;maxResults=10&amp;type=d%2Cc%2Cs%2Ca&amp;sort=sortField_desc"</span>
</code></pre>

          <h1 id="shopping-cart">Shopping Cart</h1>

<p>Shopping Cart API methods use hybrid parameters scheme, shopping cart related parameters are passed in request body as JSON.
NimbleCommerce parameters such as <code class="prettyprint">merchantId</code>, <code class="prettyprint">localeId</code>, <code class="prettyprint">securityKey</code> are passed in URL.
Shopping Cart API uses cookie to save shopping cart basic information.</p>

<aside class="notice">
You should handle shopping cart cookie manually, if you using Shopping Cart API directly.
You can access cookie by name `sc_{MERCHANT_ID}`
</aside>

<h2 id="structure">Structure</h2>

<p>Shopping cart cookie is stored as json and has strict format.
Cookie value saved as percent escaped UTF8 string enclosed with quotes.
Shopping cart can be accessed by decoding cookie value, removing enclosing quotes and parsing json string.
Cookie saves basic shopping cart information about deals that added to cart.</p>

<p>Cookie deal parameters:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>number</td>
<td>deal identifier.</td>
</tr>
<tr>
<td>cId</td>
<td>number</td>
<td>category (city) identifier.</td>
</tr>
<tr>
<td>o</td>
<td>array</td>
<td>array of deal offers.</td>
</tr>
</tbody></table>

<p>Cookie offer parameters:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>number</td>
<td>offer identifier</td>
</tr>
<tr>
<td>q</td>
<td>number</td>
<td>offer selected quantity</td>
</tr>
<tr>
<td>a</td>
<td>array</td>
<td>array of selected offer attributes (map of attributeId -&gt; optionId)</td>
</tr>
</tbody></table>

<aside class="notice">
Decoded cookie value example: "[{&ldquo;id&rdquo;:12312,&ldquo;cId&rdquo;:223,&ldquo;gifted&rdquo;:false,&ldquo;o&rdquo;:[{&ldquo;id&rdquo;:13141,&ldquo;q&rdquo;:1}]},{&ldquo;id&rdquo;:13510,&ldquo;cId&rdquo;:223,&ldquo;o&rdquo;:[{&ldquo;id&rdquo;:14508,&ldquo;q&rdquo;:2,&ldquo;a&rdquo;:[{&ldquo;2316&rdquo;:4753,&ldquo;2318&rdquo;:4759,&ldquo;2317&rdquo;:4758},{&ldquo;2316&rdquo;:4754,&ldquo;2318&rdquo;:4760,&ldquo;2317&rdquo;:4757}]},{&ldquo;id&rdquo;:14509,&ldquo;q&rdquo;:1}]}]"
</aside>

<h2 id="add-item">Add Item</h2>

<blockquote>
<p>Adding item shopping cart</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="n">NCShoppingCartItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartItem</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">item</span><span class="p">.</span><span class="n">dealId</span> <span class="o">=</span> <span class="mi">@2296932</span><span class="p">;</span>
    <span class="n">item</span><span class="p">.</span><span class="n">categoryId</span> <span class="o">=</span> <span class="mi">@25221</span><span class="p">;</span>

    <span class="n">NCShoppingCart</span> <span class="o">*</span><span class="n">cart</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">];</span>
    <span class="p">[</span><span class="n">cart</span> <span class="nf">addItem</span><span class="p">:</span><span class="n">item</span> <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Error
</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Success
</span>        <span class="p">}</span>
    <span class="p">}];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">ShoppingCartItem</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShoppingCartItem</span><span class="o">().</span><span class="na">categoryId</span><span class="o">(</span><span class="mi">25221</span><span class="o">).</span><span class="na">dealId</span><span class="o">(</span><span class="mi">2296932</span><span class="o">);</span>
    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">addItem</span><span class="o">(</span><span class="n">item</span><span class="o">,</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>

        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>

        <span class="o">}</span>
    <span class="o">},</span> <span class="n">getActivity</span><span class="o">());</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X PUT <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">cityId</span><span class="se">\"</span><span class="s2">:25221,</span><span class="se">\"</span><span class="s2">dealId</span><span class="se">\"</span><span class="s2">:2296932,</span><span class="se">\"</span><span class="s2">offers</span><span class="se">\"</span><span class="s2">:[]}"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart?merchantId<span class="o">=</span>78
</code></pre>

<p>Adds item to shopping cart. Parameters sent as json string in request body.</p>

<aside class="notice">
You should use proper content type header for requests with json body `application/json; charset=UTF-8`.
</aside>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealId</td>
<td>number</td>
<td>deal identifier</td>
</tr>
<tr>
<td>cityId</td>
<td>number</td>
<td>category (city) identifier</td>
</tr>
<tr>
<td>offers</td>
<td>array</td>
<td>empty array, will return default offer quantities in result cookie</td>
</tr>
</tbody></table>

<h2 id="remove-item">Remove Item</h2>

<blockquote>
<p>Removes item from shopping cart</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="p">[[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">]</span> <span class="nf">removeItem</span><span class="p">:</span><span class="mi">@2296932</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">removeItem</span><span class="o">(</span><span class="mi">2296932</span><span class="o">);</span>
</code></pre>

<p>Removing shopping cart item does not require network calls. 
You should remove deal object from cookie and sync your UI code.</p>

<h2 id="load-details">Load Details</h2>

<blockquote>
<p>Loads shopping cart details.</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="p">[[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">]</span> <span class="nf">load</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Handle error
</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Handle results and update UI
</span>        <span class="p">}</span>
    <span class="p">}];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">shoppingCart</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">// Handle results and update UI</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle error</span>
        <span class="o">},</span> <span class="k">this</span><span class="o">);</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X GET <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart?merchantId<span class="o">=</span>78
</code></pre>

<blockquote>
<p>Shopping cart details json</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"dealsOrder"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dealId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2296932</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cityId"</span><span class="p">:</span><span class="w"> </span><span class="mi">25221</span><span class="p">,</span><span class="w">
      </span><span class="nt">"isGift"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nt">"offers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"offerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2970562</span><span class="p">,</span><span class="w">
          </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"deals"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2296932</span><span class="p">,</span><span class="w">
      </span><span class="nt">"shortTitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Product Group Offer inc tax"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"endDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07/31/2015"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PRODUCT"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"subMerchantId"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
      </span><span class="nt">"quantityLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="nt">"quantityGiftLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LIVE"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"image"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Product Group Offer inc tax"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://s3.amazonaws.com/shop_note_stage/nimblebuy/product-group-offer-inc-tax-4302642-regular.jpg"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"offers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2970562</span><span class="p">,</span><span class="w">
          </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Product Group Offer inc tax"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"shortTitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
          </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
          </span><span class="nt">"giftQuantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
          </span><span class="nt">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">50.0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

          </span><span class="p">],</span><span class="w">
          </span><span class="nt">"shipping"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ITEM"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">29312</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FedEx-Next Day"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1 Day"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">20.0</span><span class="w">
              </span><span class="p">},</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">29322</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FedEx-Ground"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5-7 Days"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.0</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nt">"isLive"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"hasTax"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasGifting"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasCredits"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasPromoCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasGuestCheckout"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasShipping"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"merchants"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dave's photo"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"taxSettings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">6002</span><span class="p">,</span><span class="w">
        </span><span class="nt">"gbId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2296932</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyToShipping"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyToCredits"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyToPromoCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyToGift"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"includeToPrice"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"grossType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TOTAL_GROSS"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"taxKeeper"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUB_MERCHANT"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"addressToUse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORIGIN_ADDRESS"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"originAddress"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2829 mission st"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"San Francisco"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"California"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"94110"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"fullAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2829 mission st"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"joinedAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2829 mission st"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"taxRuleSetId"</span><span class="p">:</span><span class="w"> </span><span class="mi">1222</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyTaxesNotNeededForSomeVirtualMoney"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"hasDiscountProgram"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasCredits"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasPromoCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasGiftCard"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasGiftCardPin"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasAddressSave"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasAddressVerification"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasCardlinking"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasRequiredCardlinking"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasRaf"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasShipping"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasGuestCheckout"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"localeShortName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"priceFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$####.##"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datePattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MM/dd/yyyy"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"timePattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HH:mm:ss"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"currentCountry"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"msToExpire"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400000</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"billing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OnlineMart"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"has3dSecure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasRedirect"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"has1ClickBuy"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"secondaryTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"creditCardTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Visa"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"visa"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4[0-9]{12}(?:[0-9]{3})?$"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Master Card"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"master_card"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^5[1-5][0-9]{14}$"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Discover"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"discover"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6(011|5[0-9]{2})[0-9]{12}$"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Amex"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amex"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3[47][0-9]{13}$"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"creditCardFee"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Shopping cart details loading requires cookie to be set in request. 
As result you&rsquo;ll get details to show shopping cart UI to user and proceed with checkout process.
Results can be accesses as properties in Shoppint Cart singletones on iOS/Android SDKs, this classes have identical to JSON structure.</p>

<p><em>Result JSON values:</em></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealsOrder</td>
<td>object</td>
<td>order in JSON format, will represent cookie value</td>
</tr>
<tr>
<td>deals</td>
<td>array</td>
<td>list of deal details</td>
</tr>
<tr>
<td>options</td>
<td>object</td>
<td>set of shopping cart options, flags that presents different NimbleCommerce features</td>
</tr>
<tr>
<td>settings</td>
<td>object</td>
<td>overall shopping cart settings</td>
</tr>
<tr>
<td>billing</td>
<td>object</td>
<td>shopping cart billing settings</td>
</tr>
</tbody></table>

<h2 id="promo-codes">Promo codes</h2>

<blockquote>
<p>Loads promo code information</p>
</blockquote>
<pre class="highlight objective_c"><code>
    <span class="c1">// NOTE, You should keep strong reference to the loaders
</span>    <span class="n">self</span><span class="p">.</span><span class="n">promoCodeLoader</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCPromoCodeValidate</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">promoCodeLoader</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">promoCodeLoader</span> <span class="nf">validatePromoCode</span><span class="p">:</span><span class="s">@"111111"</span> <span class="nf">deals</span><span class="p">:@[</span><span class="mi">@2296932</span><span class="p">]];</span>

    <span class="c1">// Implement delegated methods and process result.
</span>    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">promoCodeValidationSucceed</span><span class="p">:(</span><span class="n">NCPromoCodeValidate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">promoCodeValidationFailed</span><span class="p">:(</span><span class="n">NCPromoCodeValidate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="nf">withError</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span> <span class="p">{</span>
    <span class="p">}</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">ResultHandler</span> <span class="n">resultHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle success</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handler error</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="k">new</span> <span class="n">PromoCodeAmount</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
                <span class="o">.</span><span class="na">dealIds</span><span class="o">(</span><span class="n">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="mi">2296932</span><span class="o">))</span>
                <span class="o">.</span><span class="na">promoCode</span><span class="o">(</span><span class="s">"111111"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="n">resultHandler</span><span class="o">)</span>
                <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
        <span class="o">}</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">number</span><span class="se">\"</span><span class="s2">:111111,</span><span class="se">\"</span><span class="s2">dealIds</span><span class="se">\"</span><span class="s2">:"</span>2296932<span class="s2">"}"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart/calculate?merchantId<span class="o">=</span>78<span class="se">\&amp;</span><span class="nb">type</span><span class="o">=</span>PROMO_CODE
</code></pre>

<blockquote>
<p>Result JSON</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">1234.0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AMOUNT"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dealIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="mi">2296932</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Loads promo code value for applicable deals. Will return array with deal identifiers that can apply promo code.</p>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>number</td>
<td>string</td>
<td>promo code number</td>
</tr>
<tr>
<td>dealIds</td>
<td>string</td>
<td>deals identifiers comma separated string</td>
</tr>
</tbody></table>

<p><em>Result JSON values:</em></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>number</td>
<td>promo code amount, can represent percent value</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>promo code type, <code class="prettyprint">AMOUNT</code> or <code class="prettyprint">PERCENT</code></td>
</tr>
<tr>
<td>dealIds</td>
<td>array</td>
<td>list of applicable deals</td>
</tr>
</tbody></table>

<h2 id="gift-cards">Gift cards</h2>

<blockquote>
<p>Loads gift card information</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">number</span><span class="se">\"</span><span class="s2">:62035,</span><span class="se">\"</span><span class="s2">pin</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"\"</span><span class="s2">}"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: {AUTHORIZATION_TOKEN}"</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart/calculate?merchantId<span class="o">=</span>78<span class="se">\&amp;</span><span class="nb">type</span><span class="o">=</span>GIFT_CARD
</code></pre>
<pre class="highlight objective_c"><code>
    <span class="c1">// NOTE, You should keep strong references to the loaders
</span>    <span class="n">self</span><span class="p">.</span><span class="n">giftCardValidator</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCGiftCardValidate</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">giftCardValidator</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">giftCardValidator</span> <span class="nf">validateGiftCard</span><span class="p">:</span><span class="s">@"62035"</span> <span class="nf">pinCode</span><span class="p">:</span><span class="s">@""</span><span class="p">];</span>

    <span class="c1">// Implement delegated methods and process result.
</span>    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">giftCardValidationSucceed</span><span class="p">:(</span><span class="n">NCGiftCardValidate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">giftCardValidateFailed</span><span class="p">:(</span><span class="n">NCGiftCardValidate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="nf">withError</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span> <span class="p">{</span>
    <span class="p">}</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">CheckGiftCard</span><span class="o">.</span><span class="na">ResultHandler</span> <span class="n">resultHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CheckGiftCard</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">GiftCard</span> <span class="n">giftCard</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle success   </span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle error</span>
        <span class="o">}</span>
        <span class="k">new</span> <span class="n">CheckGiftCard</span><span class="o">(</span><span class="n">getActivity</span><span class="o">())</span>
                <span class="o">.</span><span class="na">cardNumber</span><span class="o">(</span><span class="s">"62035"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">cardPin</span><span class="o">(</span><span class="s">""</span><span class="o">)</span>
                <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="n">resultHandler</span><span class="o">)</span>
                <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>Result JSON</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">10.0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Checks gift card balance. Returns amount of available credits on gift card.</p>

<aside class="notice">
Authorization required for this call, you should put valid `Authorization Token` into request headers.
</aside>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>number</td>
<td>string</td>
<td>gift card number</td>
</tr>
<tr>
<td>pin</td>
<td>string</td>
<td>gift card pin code</td>
</tr>
</tbody></table>

<p><em>Result JSON values:</em></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>number</td>
<td>gift card available balance</td>
</tr>
</tbody></table>

<h2 id="taxes">Taxes</h2>

<blockquote>
<p>Loads tax amounts for shopping cart</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s1">'{"shippingAddress":{"address":"sdflsjdklf","address2":"sjdfkjsdkfj","firstName":"laksdjflksdjf","city":"sdjfksdjfk","phone":"28348902384","zip":"90210","countryCode":"US","state":"California","lastName":"lksdjfklsdjfkl"},"dealsOrder":[{"dealId":2296952,"cityId":25221,"offers":[{"offerId":2970592,"count":1,"shippingMethodId":29352}]}]}'</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: {AUTHORIZATION_TOKEN}"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart/calculateTaxAmount?merchantId<span class="o">=</span>78
</code></pre>
<pre class="highlight objective_c"><code>    <span class="n">NCShoppingCartOrderDiscounts</span> <span class="o">*</span><span class="n">discounts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartOrderDiscounts</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">promoCode</span> <span class="o">=</span> <span class="p">{</span><span class="n">PROMO_CODE</span><span class="p">};</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">giftCards</span> <span class="o">=</span> <span class="p">{</span><span class="n">GIFT_CARDS</span><span class="p">};</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">credits</span> <span class="o">=</span> <span class="p">{</span><span class="n">USED_CREDITS</span><span class="p">};</span>

    <span class="n">NCShoppingCartOrderInfo</span> <span class="o">*</span><span class="n">orderInfo</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartOrderInfo</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">discounts</span> <span class="o">=</span> <span class="n">discounts</span><span class="p">;</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">shippingAddress</span> <span class="o">=</span> <span class="p">{</span><span class="n">SHIPPING_ADDRESS</span><span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">isCardless</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">paymentAccount</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">paymentInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCShoppingCartPaymentInfo</span> <span class="nf">paymentInfoFromPaymentAccount</span><span class="p">:</span><span class="n">paymentAccount</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">billingAddress</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">billingAddress</span> <span class="o">=</span> <span class="n">billingAddress</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hasBillingTaxes</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">taxAddress</span> <span class="o">=</span> <span class="n">taxAddress</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">]</span> <span class="nf">loadTaxAmountsWithOrderInfo</span><span class="p">:</span><span class="n">orderInfo</span>
                                               <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="n">NSArray</span> <span class="o">*</span><span class="n">taxAmounts</span><span class="p">)</span> <span class="p">{</span>
                                                   <span class="c1">// Handle results
</span>                                               <span class="p">}];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderInfo</span> <span class="n">orderInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderInfo</span><span class="o">();</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">promoCode</span><span class="o">(</span><span class="n">promoCode</span><span class="o">);</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">giftCards</span><span class="o">(</span><span class="n">giftCards</span><span class="o">());</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">credits</span><span class="o">(</span><span class="n">creditsUsed</span><span class="o">());</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">isCardless</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderInfo</span><span class="o">.</span><span class="na">taxAddress</span><span class="o">(</span><span class="n">taxAddress</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">paymentInfo</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">orderInfo</span><span class="o">.</span><span class="na">paymentInfo</span><span class="o">(</span><span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderPaymentInfo</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">paymentInfo</span><span class="o">()));</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">paymentInfo</span><span class="o">.</span><span class="na">paymentAccountId</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">orderInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">(</span><span class="n">paymentInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">shippingAddress</span><span class="o">(</span><span class="n">shippingAddress</span><span class="o">);</span>
    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">loadTaxAmounts</span><span class="o">(</span><span class="n">orderInfo</span><span class="o">,</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">// Handle success</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle error</span>
        <span class="o">},</span> <span class="n">getActivity</span><span class="o">());</span>
</code></pre>

<blockquote>
<p>Result JSON</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"offersTaxData"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"offerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2970592</span><span class="p">,</span><span class="w">
      </span><span class="nt">"gbId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2296952</span><span class="p">,</span><span class="w">
      </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">6.30</span><span class="p">,</span><span class="w">
      </span><span class="nt">"includedToPrice"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nt">"taxEnabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"canPayTaxesWithCredits"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"canPayTaxesWithPromoCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"canPayTaxesWithGiftCards"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealsOrder</td>
<td>array</td>
<td>array of deals in shopping cart</td>
</tr>
<tr>
<td>discounts</td>
<td>object</td>
<td>map of used discounts for shopping cart (credits, gift cards and promo code)</td>
</tr>
<tr>
<td>shippingAddress</td>
<td>object</td>
<td>shipping address, can be used only for passing saved address identifier (if you have one), this will retrieve shipping address from saved address in your account (requires authorization).</td>
</tr>
<tr>
<td>billingAddress</td>
<td>object</td>
<td>address used for billing</td>
</tr>
<tr>
<td>paymentInfo</td>
<td>object</td>
<td>should be used only for passing payment account identifier (requires authorization), this will retrieve billing address from saved payment account in your account</td>
</tr>
<tr>
<td>taxAddress</td>
<td>object</td>
<td>address for tax calculations, should be used only when tax calculations are based on billing information and no billing needed for shopping cart (case when total value is fully covered with credits, purchase without payment)</td>
</tr>
</tbody></table>

<aside class="warning">
Load tax method does not send directly any credit card related information. Billing address should contain only address fields. You can only send payment account identifier in `paymentInfo` to get billing address from previously saved payment account.
</aside>

<aside class="notice">
You should never call this method via `http` protocol, use `https` for all Shopping Cart API calls.
</aside>

<p><strong>Loading tax amounts for gift items</strong></p>

<p>Tax amounts loading request has request parameters structure similar to checkout request paramaters, except of missing payment related parameters. Note that you should include gift information with address information in case when you have deal with shipping information (product or coupon with shipping).</p>

<p><strong>Triggering tax amounts loading:</strong></p>

<p>When you load shopping cart details you got <code class="prettyprint">taxSettings</code> object for every deal object. 
If taxes enabled for specific deal than you should trigger tax amount calculation at a certain time and <code class="prettyprint">taxSettings</code> object will help you find out in which one.
In addition to all the other fields <code class="prettyprint">taxSettings</code> contain <code class="prettyprint">addressToUse</code> property which shows what changes will trigger tax amounts loading.</p>

<aside class="notice">
It is recommended to do tax amount loading in async tasks on actions that affects total value (offers quantity change, shipping methods change, applying discounts etc) and on specific tax triggers described above.
</aside>

<p><em><code class="prettyprint">addressToUse</code> values:</em></p>

<table><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ORIGIN_ADDRESS</td>
<td>tax amount calculation is based on shipping address</td>
</tr>
<tr>
<td>CUSTOMERS_BILLING_ADDRESS</td>
<td>tax amount calculation is based on shipping address</td>
</tr>
<tr>
<td>SUB_MERCHANT_LOCATION</td>
<td>tax amount calculation is based on submerchant location, this type of taxes will be triggered when user selects merchant location attribute (will have <code class="prettyprint">isLocation</code> flag from API version 7), if no location attributes available for deal than you should load tax once for deal after shopping cart loaded.</td>
</tr>
<tr>
<td>PREDEFINED_STATE</td>
<td>tax amount calculation is based on predefined state, this value is predefined on backend, you should load tax once for deal after shopping cart loaded.</td>
</tr>
</tbody></table>

<p><strong>Handling results:</strong></p>

<p>As a result of loading you&rsquo;ll get array with tax amounts objects which will help you calculate totals of your shopping cart and complete preparing for checkout.
You should include received amounts to shopping cart calculations as additional amount of money to pay.</p>

<p><em>Tax amount object values:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>gbId</td>
<td>number</td>
<td>deal identifier</td>
</tr>
<tr>
<td>offerId</td>
<td>number</td>
<td>offer identifier</td>
</tr>
<tr>
<td>amount</td>
<td>number</td>
<td>value of taxes calculated for the deal</td>
</tr>
<tr>
<td>includedToPrice</td>
<td>boolean</td>
<td>flag indicates that tax value is already included to offer price and should not be added to shopping cart total.</td>
</tr>
<tr>
<td>canPayTaxesWithCredits</td>
<td>boolean</td>
<td>currently ignored, always true</td>
</tr>
<tr>
<td>canPayTaxesWithGiftCards</td>
<td>boolean</td>
<td>currently ignored, always true</td>
</tr>
<tr>
<td>canPayTaxesWithPromoCode</td>
<td>boolean</td>
<td>currently ignored, always true</td>
</tr>
</tbody></table>

<h2 id="checkout">Checkout</h2>

<p>Shopping cart checkout is fully handled by ShoppingCart singletons. 
You should fill <code class="prettyprint">OrderInfo</code> bean with your shopping cart details and call checkout method of <code class="prettyprint">ShoppingCart</code>.
Shopping cart checkout is highly critical process, you should do all the possible validation checks before completing purchase.</p>

<blockquote>
<p>Performs shopping cart checkout</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s1">'{"dealsOrder":[{"dealId":2296952,"cityId":25221,"offers":[{"offerId":2970592,"count":1,"shippingMethodId":29352}]}],"shippingAddress":{"address":"Main street 1","address2":"","firstName":"First","city":"Beverly Hills","phone":"555-555555","zip":"90210","countryCode":"US","state":"California","lastName":"Last"},"billingAddress":{"address":"Main street 1","address2":"","firstName":"First","city":"Beverly Hills","phone":"555-555555","zip":"90210","countryCode":"US","state":"California","lastName":"Last"},"guestEmail":"test@user.com","paymentInfo":{"cardType":"visa","secureCode":"123","firstName":"First","cardNumber":"4111111111111111","expirationMonth":2,"expirationYear":2017,"lastName":"Last"}}'</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: {AUTHORIZATION_TOKEN}"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart/makeBuy?merchantId<span class="o">=</span>78
</code></pre>
<pre class="highlight objective_c"><code>    <span class="n">NCShoppingCartOrderDiscounts</span> <span class="o">*</span><span class="n">discounts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartOrderDiscounts</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">promoCode</span> <span class="o">=</span> <span class="p">{</span><span class="n">PROMO_CODE</span><span class="p">};</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">giftCards</span> <span class="o">=</span> <span class="p">{</span><span class="n">GIFT_CARDS</span><span class="p">};</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">credits</span> <span class="o">=</span> <span class="p">{</span><span class="n">USED_CREDITS</span><span class="p">};</span>

    <span class="n">NCShoppingCartOrderInfo</span> <span class="o">*</span><span class="n">orderInfo</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartOrderInfo</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">discounts</span> <span class="o">=</span> <span class="n">discounts</span><span class="p">;</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">guestEmail</span> <span class="o">=</span> <span class="p">{</span><span class="n">GUEST_EMAIL</span><span class="p">};</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">birthDate</span> <span class="o">=</span> <span class="p">{</span><span class="n">BIRTH_DATE</span><span class="p">};</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">merchantOptIns</span> <span class="o">=</span> <span class="p">{</span><span class="n">MERCHANT_OPT_INS</span><span class="p">};</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">shippingAddress</span> <span class="o">=</span> <span class="p">{</span><span class="n">SHIPPING_ADDRESS</span><span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">isCardless</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">paymentAccount</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">paymentInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCShoppingCartPaymentInfo</span> <span class="nf">paymentInfoFromPaymentAccount</span><span class="p">:</span><span class="n">paymentAccount</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">billingInfo</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">paymentInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCShoppingCartPaymentInfo</span> <span class="nf">paymentInfoFromBillingInfo</span><span class="p">:</span><span class="n">billingInfo</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">orderInfo</span><span class="p">.</span><span class="n">paymentInfo</span><span class="p">.</span><span class="n">cardCVV</span> <span class="o">=</span> <span class="n">secureCode</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hasBillingTaxes</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">taxAddress</span> <span class="o">=</span> <span class="n">taxAddress</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">]</span> <span class="nf">checkoutWithOrderInfo</span><span class="p">:</span><span class="n">orderInfo</span> <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Handle error
</span>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// Handle success
</span>            <span class="p">}</span>
        <span class="p">}];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderInfo</span> <span class="n">orderInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderInfo</span><span class="o">();</span>

    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">promoCode</span><span class="o">({</span><span class="n">PROMO_CODE</span><span class="o">});</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">giftCards</span><span class="o">({</span><span class="n">GIFT_CARDS</span><span class="o">});</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">credits</span><span class="o">({</span><span class="n">USED_CREDITS</span><span class="o">});</span>

    <span class="n">orderInfo</span><span class="o">.</span><span class="na">guestEmail</span><span class="o">({</span><span class="n">GEUEST_EMAIL</span><span class="o">});</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">dateOfBirth</span><span class="o">({</span><span class="n">BIRTH_DATE</span><span class="o">});</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">merchantOptIns</span><span class="o">({</span><span class="n">MERCHANT_OPT_INS</span><span class="o">});</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">isCardless</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderInfo</span><span class="o">.</span><span class="na">taxAddress</span><span class="o">(</span><span class="n">taxAddress</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">paymentInfo</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">orderInfo</span><span class="o">.</span><span class="na">paymentInfo</span><span class="o">(</span><span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderPaymentInfo</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">paymentInfo</span><span class="o">));</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">paymentInfo</span><span class="o">.</span><span class="na">paymentAccountId</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">orderInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">(</span><span class="n">paymentInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">billingInfo</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">billingInfo</span><span class="o">.</span><span class="na">id</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">orderInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">(</span><span class="n">billingInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="n">orderInfo</span><span class="o">.</span><span class="na">paymentInfo</span><span class="o">(</span><span class="n">OrderPaymentInfo</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">billingInfo</span><span class="o">));</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">secureCode</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">orderInfo</span><span class="o">.</span><span class="na">paymentInfo</span><span class="o">().</span><span class="na">cardCVV</span><span class="o">(</span><span class="n">secureCode</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">shippingAddress</span><span class="o">(</span><span class="n">shippingAddress</span><span class="o">);</span>
    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">loadTaxAmounts</span><span class="o">(</span><span class="n">orderInfo</span><span class="o">,</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">// Handle success</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle error</span>
        <span class="o">},</span> <span class="n">getActivity</span><span class="o">());</span>
</code></pre>

<blockquote>
<p>Result JSON</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">71856942</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealsOrder</td>
<td>array</td>
<td>array of deals in shopping cart</td>
</tr>
<tr>
<td>discounts</td>
<td>object</td>
<td>map of used discounts for shopping cart (credits, gift cards and promo code)</td>
</tr>
<tr>
<td>shippingAddress</td>
<td>object</td>
<td>shipping address, can be used only for passing saved address identifier (if you have one), this will retrieve shipping address from saved address in your account (requires authorization).</td>
</tr>
<tr>
<td>billingAddress</td>
<td>object</td>
<td>address used for billing</td>
</tr>
<tr>
<td>paymentInfo</td>
<td>object</td>
<td>payment account id or full credit card information, credit card CVV is required for checkout.</td>
</tr>
<tr>
<td>taxAddress</td>
<td>object</td>
<td>address for tax calculations, should be used only when tax calculations are based on billing information and no billing needed for shopping cart (case when total value is fully covered with discounts, purchase without payment)</td>
</tr>
<tr>
<td>guestEmail</td>
<td>string</td>
<td>email for guest checkout, can&rsquo;t use saved payment accounts or addresses, full credit card information is required if purchase is not cardless (fully covered with discounts).</td>
</tr>
<tr>
<td>dateOfBirth</td>
<td>string</td>
<td><code class="prettyprint">en_US_POSIX</code> string with user birth date, optional field, should be filled if required.</td>
</tr>
<tr>
<td>merchantOptIns</td>
<td>array</td>
<td>list of merchant opt ins</td>
</tr>
</tbody></table>

<p><em>Order item structure</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealId</td>
<td>number</td>
<td>deal identifier</td>
</tr>
<tr>
<td>cityId</td>
<td>number</td>
<td>city identifier</td>
</tr>
<tr>
<td>offers</td>
<td>array</td>
<td>array of order item offers</td>
</tr>
<tr>
<td>shippingMethodId</td>
<td>number</td>
<td>shipping method identifier for deal</td>
</tr>
<tr>
<td>isGift</td>
<td>boolean</td>
<td>gifting flag</td>
</tr>
<tr>
<td>giftInfo</td>
<td>object</td>
<td>object with gifting information</td>
</tr>
</tbody></table>

<p><em>Order offer structure</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>offerId</td>
<td>number</td>
<td>offer identifier</td>
</tr>
<tr>
<td>count</td>
<td>number</td>
<td>offer count</td>
</tr>
<tr>
<td>shippingMethodId</td>
<td>number</td>
<td>selected shipping method for offer</td>
</tr>
<tr>
<td>attributes</td>
<td>array</td>
<td>selected offer attributes</td>
</tr>
</tbody></table>

<p><em>Gift information structure</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>recipientName</td>
<td>string</td>
<td>gift recipient name</td>
</tr>
<tr>
<td>senderName</td>
<td>string</td>
<td>gift sender name</td>
</tr>
<tr>
<td>message</td>
<td>string</td>
<td>gift message</td>
</tr>
<tr>
<td>recipientEmail</td>
<td>string</td>
<td>gift recipient email, used for deals without shipping (product or coupons with shipping)</td>
</tr>
<tr>
<td>addressId</td>
<td>number</td>
<td>gift recipient address, saved address identifier to use for gifting</td>
</tr>
<tr>
<td>address</td>
<td>object</td>
<td>gift recipient address, address object to use for gifting</td>
</tr>
</tbody></table>

<aside class="notice">
You should never call this method via `http` protocol, use `https` for all Shopping Cart API calls.
</aside>

<aside class="warning">
You should not store any payment related information on client side.
</aside>

          <h1 id="purchases">Purchases</h1>

<p>You can load your purchases list by calling <code class="prettyprint">/api/userDealList.action</code>. 
This call allows you to receive user purchase list with filters for authorized user.</p>

<aside class="notice">
This method has basic pagination functionality, but it does not allow to select page size and it is hardcoded on a backend to return pages with maximum 5 items in list.
</aside>

<p>Parameters for purchases loading API call:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>page</td>
<td>number</td>
<td>list page to load</td>
</tr>
<tr>
<td>filter</td>
<td>string</td>
<td>filtering parameter</td>
</tr>
</tbody></table>

<p>Filter parameter constants:</p>

<table><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>available</td>
<td>available purchases</td>
</tr>
<tr>
<td>expired</td>
<td>expired purchases</td>
</tr>
<tr>
<td>used</td>
<td>used purchases</td>
</tr>
<tr>
<td>received</td>
<td>received gifts</td>
</tr>
<tr>
<td>sent</td>
<td>sent gifts</td>
</tr>
<tr>
<td>membershipAvailable</td>
<td>available rewards</td>
</tr>
<tr>
<td>membershipUsed</td>
<td>used rewards</td>
</tr>
</tbody></table>

<blockquote>
<p>Load purchases list</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="n">self</span><span class="p">.</span><span class="n">loader</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCUserDealsList</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">loader</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>

    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loader</span> <span class="nf">getDealsWithFilter</span><span class="p">:</span><span class="n">NCUserDealListFilterAvailable</span> <span class="nf">page</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>

    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">userDealsListingSucceed</span><span class="p">:(</span><span class="n">NCUserDealsList</span> <span class="o">*</span><span class="p">)</span><span class="nv">loader</span> <span class="p">{</span>
        <span class="c1">// Handle loader.deals
</span>    <span class="p">}</span>
    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">userDealsListingFailed</span><span class="p">:(</span><span class="n">NCUserDealsList</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="nf">withError</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span> <span class="p">{</span>
        <span class="c1">// Handle request error
</span>    <span class="p">}</span>
</code></pre>
<pre class="highlight java"><code>    <span class="c1">// AsyncTask class example for purchases list loading</span>
    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">DealsLoader</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onPreExecute</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">Void</span> <span class="n">doInBackground</span><span class="o">(</span><span class="n">Void</span><span class="o">...</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">GroupBuyList</span> <span class="n">offersList</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">offersList</span> <span class="o">=</span> <span class="n">Nmb</span><span class="o">.</span><span class="na">getDealsManager</span><span class="o">().</span><span class="na">getMyCouponsList</span><span class="o">(</span><span class="n">mCurrentPage</span><span class="o">,</span> <span class="n">filter</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ServerIsDownException</span> <span class="o">|</span> <span class="n">ConnectionException</span> <span class="o">|</span> <span class="n">ConnectionTimeoutException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="c1">// Handle request exception</span>
            <span class="o">}</span>

            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">offersList</span> <span class="o">&amp;&amp;</span> <span class="n">offersList</span><span class="o">.</span><span class="na">totalCount</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Save received purchase list for further processing</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onPostExecute</span><span class="o">(</span><span class="n">Void</span> <span class="n">aVoid</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">getView</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="c1">// Handle results</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
<pre class="highlight shell"><code>    curl <span class="se">\</span>
    -X GET <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: MTQ0MDA1NDcwNjU4Nzo6OjEwMjk4NTgzMjo6OnJCTzhWN2hxb0p5ZEFjQldUMDR2VWc9PTo6OlNVQlNDUklCRVJfSUQ="</span> <span class="se">\</span>
    <span class="s2">"http://stage.nimblebuy.com/api/userDealList.action?merchantId=78&amp;page=0&amp;filter=available"</span>
</code></pre>

          <h1 id="order-status">Order Status</h1>

<p>From NimbleCommerce API version 6 you have access to order status loading methods. 
This methods include loading order details, view and redeem order vouchers.
You can check order status without registering user account, you need only email and order number to proceed.
First thing you need to do is perform partial authorization and get temporary authorization key, which is required to access order status API methods.</p>

<blockquote>
<p>Authorize for orders resource</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="n">self</span><span class="p">.</span><span class="n">authorizator</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCAuthorization</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">]</span>
    <span class="n">self</span><span class="p">.</span><span class="n">authorizator</span><span class="p">.</span><span class="n">onSuccess</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NCLoader</span> <span class="o">*</span><span class="n">loader</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// auth token returned in loader.authorizationKey
</span>    <span class="p">};</span>
    <span class="n">self</span><span class="p">.</span><span class="n">authorizator</span><span class="p">.</span><span class="n">onFailure</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NCLoader</span> <span class="o">*</span><span class="n">loader</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle error
</span>    <span class="p">};</span>
    <span class="c1">// Authorizes for orders resource for given email.
</span>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">authorizator</span> <span class="nf">authorizeForResource</span><span class="p">:</span><span class="s">@"orders"</span> <span class="nf">withEmail</span><span class="p">:</span><span class="s">@"user@email.com"</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">AuthorizeResource</span><span class="p">(</span><span class="k">this</span><span class="o">).</span><span class="na">resource</span><span class="o">(</span><span class="s">"orders"</span><span class="o">).</span><span class="na">email</span><span class="o">(</span><span class="s">"user@email.com"</span><span class="o">).</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">AuthorizeResource</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">authKey</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Boolean</span> <span class="n">hasAccount</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// handle success</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// handle error</span>
        <span class="o">}</span>
    <span class="o">}).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"email=user@email.com&amp;resource=orders"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/authorize?merchantId<span class="o">=</span>78
</code></pre>

<blockquote>
<p>Load order details</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="n">self</span><span class="p">.</span><span class="n">loader</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCOrderGet</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">loader</span><span class="p">.</span><span class="n">authorizationKey</span> <span class="o">=</span> <span class="n">authorizationKey</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">loader</span><span class="p">.</span><span class="n">onSuccess</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NCLoader</span> <span class="o">*</span><span class="n">loader</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle loader.order
</span>    <span class="p">};</span>
    <span class="n">self</span><span class="p">.</span><span class="n">orderLoader</span><span class="p">.</span><span class="n">onFailure</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NCLoader</span> <span class="o">*</span><span class="n">loader</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle request handler
</span>    <span class="p">};</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loader</span> <span class="nf">getPaidOrder</span><span class="p">:</span><span class="n">orderNumber</span><span class="p">];</span> 
</code></pre>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">LoadOrder</span><span class="p">(</span><span class="n">getActivity</span><span class="o">()).</span><span class="na">orderId</span><span class="o">(</span><span class="n">orderNumber</span><span class="o">).</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">LoadOrder</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// handle request success</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// handle request error</span>
        <span class="o">}</span>
    <span class="o">}).</span><span class="na">authorizationKey</span><span class="o">(</span><span class="n">authorizationKey</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X GET <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: MTQ0MDA1NDcwNjU4Nzo6OjEwMjk4NTgzMjo6OnJCTzhWN2hxb0p5ZEFjQldUMDR2VWc9PTo6OlNVQlNDUklCRVJfSUQ="</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/orders/paid/1234?merchantId<span class="o">=</span>78
</code></pre>

<blockquote>
<p>Load order items (for product deals only)</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="n">self</span><span class="p">.</span><span class="n">itemsLoader</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCOrderItemsGet</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">itemsLoader</span><span class="p">.</span><span class="n">authorizationKey</span> <span class="o">=</span> <span class="n">authorizationKey</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">itemsLoader</span><span class="p">.</span><span class="n">onSuccess</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NCLoader</span> <span class="o">*</span><span class="n">loader</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle loader.items array
</span>    <span class="p">};</span>
    <span class="n">self</span><span class="p">.</span><span class="n">itemsLoader</span><span class="p">.</span><span class="n">onFailure</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NCLoader</span> <span class="o">*</span><span class="n">loader</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle request error
</span>    <span class="p">};</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">itemsLoader</span> <span class="nf">getPaidOrderItems</span><span class="p">:</span><span class="n">orderNumber</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="n">LoadOrderItems</span><span class="o">.</span><span class="na">Paid</span><span class="o">(</span><span class="n">getActivity</span><span class="o">()).</span><span class="na">orderId</span><span class="o">(</span><span class="n">orderNumber</span><span class="o">).</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">LoadOrderItems</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span> <span class="n">orderItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle request success</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle request error</span>
        <span class="o">}</span>
    <span class="o">}).</span><span class="na">authorizationKey</span><span class="o">(</span><span class="n">authorizationKey</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X GET <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: MTQ0MDA1NDcwNjU4Nzo6OjEwMjk4NTgzMjo6OnJCTzhWN2hxb0p5ZEFjQldUMDR2VWc9PTo6OlNVQlNDUklCRVJfSUQ="</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/orders/paid/1234/items?merchantId<span class="o">=</span>78
</code></pre>

<blockquote>
<p>Load order vouchers (for non product deals only)</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="n">self</span><span class="p">.</span><span class="n">vouchersLoader</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCOrderVouchersGet</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">vouchersLoader</span><span class="p">.</span><span class="n">authorizationKey</span> <span class="o">=</span> <span class="n">authorizationKey</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">vouchersLoader</span><span class="p">.</span><span class="n">onSuccess</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NCLoader</span> <span class="o">*</span><span class="n">loader</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle loader.vouchers array
</span>    <span class="p">};</span>
    <span class="n">self</span><span class="p">.</span><span class="n">vouchersLoader</span><span class="p">.</span><span class="n">onFailure</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NCLoader</span> <span class="o">*</span><span class="n">loader</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle request error
</span>    <span class="p">};</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">vouchersLoader</span> <span class="nf">getPaidOrderVouchers</span><span class="p">:</span><span class="n">orderNumber</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="n">LoadOrderVouchers</span><span class="o">.</span><span class="na">Paid</span><span class="o">(</span><span class="n">getActivity</span><span class="o">()).</span><span class="na">orderId</span><span class="o">(</span><span class="n">orderNumber</span><span class="o">).</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">LoadOrderVouchers</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderVoucher</span><span class="o">&gt;</span> <span class="n">orderVouchers</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle request success</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handler request error</span>
        <span class="o">}</span>
    <span class="o">}).</span><span class="na">authorizationKey</span><span class="o">(</span><span class="n">authorizationKey</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X GET <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: MTQ0MDA1NDcwNjU4Nzo6OjEwMjk4NTgzMjo6OnJCTzhWN2hxb0p5ZEFjQldUMDR2VWc9PTo6OlNVQlNDUklCRVJfSUQ="</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/orders/paid/1234/vouchers?merchantId<span class="o">=</span>78
</code></pre>

          <h1 id="ios-sdk">iOS SDK</h1>

<p>Welcome to NimbleCommerce iOS SDK. Our SDK is a wrapper around NimbleCommerce API which provides native interfaces to communicate with NimbleCommerce platform.
This section has general information and recommendation about SDK usage. Out classes are self-documented, you should study class interface and inline documentation before using any SDK class.</p>

          <h2 id="change-log">Change Log</h2>

<p>NimbleCommerce iOS SDK changes</p>

<h3 id="1-5-30">1.5.30</h3>

<ul>
<li>API version 7 introduced</li>
<li>Sales tax support, additional documentation can be found in Shopping Cart -&gt; Taxes section </li>
<li>Shipping support for offline coupons</li>
<li>Franchise offers support</li>
<li>Multi offer merchant deals support</li>
<li>Merchant opt-ins support</li>
<li>Direct usage of *.nimblecommerce.com endpoints for API access is restricted, *.nimblebuy.com or another FE endpoint should be used instead. SDK will automatically substitute *.nimblecommerce.com with *.nimblebuy.com.</li>
</ul>

          <h2 id="get-started">Get Started</h2>

<ol>
<li><p>The NimbleCommerce SDK for iOS is designed to be easy to install and use. This guide walks you through the basics of setting up the development and project environment and creating a simple application.</p></li>
<li><p>Install prerequisites. OS X and Xcode is required for iOS development. Xcode is available through the App Store.
Download NimbleCommerce iOS SDK. NimbleCommerce iOS SDK is distributed as framework and available to download in MobileApps section at your merchant portal. Keep an eye on updates, replace framework included to your projects, when new version become available.</p></li>
<li><p>Create and configure an Xcode project. Create a new Xcode project, add NimbleCommerce iOS SDK by dragging nc-ios-sdk.framework into the Frameworks section of your Project navigator. Framework is distributed in debug and release versions, debug version doesnât strip debug messages logging code, to let developer see debug information.
The SDK relies on four other frameworks/libraries (CFNetwork, MobileCoreServices, SystemConfiguration and libz). To add these, go to the <code class="prettyprint">Link Binary with Libraries</code> of the targetâs Build phases pane, and click the <code class="prettyprint">plus</code> button to add them.</p></li>
<li><p>Configure NimbleCommerce application. Basic configuration is made using NCSettings.plist file, which should be created in main bundle of your application. It is recommended to use NCSettings.plist from NimbleCommerce Demo Application as example.</p></li>
</ol>

<p>NCSettings.plist required fields:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>version</td>
<td>settings file version, number value displaying version of configuration file. You should increment this value every time you made changes to apply them on next application run.</td>
</tr>
<tr>
<td>merchantId</td>
<td>NimbleCommerce merchant identifier. Unique merchant identifier used in by NimbleCommerce API calls.</td>
</tr>
<tr>
<td>identifier</td>
<td>NimbleCommerce mobile application identifier.</td>
</tr>
<tr>
<td>secretKey</td>
<td>NimbleCommerce mobile application secret key. String value used by all NimbleCommerce API calls to validate application permission to use NimbleCommerce API.</td>
</tr>
<tr>
<td>apiUrl</td>
<td>NimbleCommerce API root url. Root url used to perform API calls.</td>
</tr>
<tr>
<td>apiSecureUrl</td>
<td>NimbleCommerce API root secure url. Root url used to perform secure API calls (Usually the same as url as apiUrl but with https protocol).</td>
</tr>
<tr>
<td>countryCode</td>
<td>application country code (ISO 3166-1 alpha-2 code). Used to perform country specific fields validation (zip code, state, etc).</td>
</tr>
<tr>
<td>cardTypes</td>
<td>array of supported by application credit card types. Array should contain at least one card type.</td>
</tr>
</tbody></table>

<p><code class="prettyprint">NCSettingsManager</code> is singleton that manages application settings. It is main application manager and it should be configured before performing any API calls. To perform configuration you should send configure message to sharedInstance of NCSettingsManager.</p>

<p>Settings manager will dispatch couple of notifications about its configuration process status changes. Basically, you should add observers for NCSettingsManagerConfigureFinishNotification and NCSettingsManagerConfigureFailNotification, where you should handle successful or failed configuration.</p>

<p><code class="prettyprint">NCMerchantManager</code> is singleton that manages merchant specific settings and data, currently it is list of categories and tags. To perform configuration you should complete settings manager configuration and send configure message to sharedInstance of NCMerchantManager. </p>

<p>Merchant manager will dispatch couple of notifications about its configuration process status changes. You should add observers for NCMerchantManagerConfigureFinishNotification and NCMerchantManagerConfigureFailNotification, where you should handle successful or failed configuration. Merchant manager usage is optional, NimbleCommerce SDK classes does not use merchant manager directly, it is used by demo application to provide common access to merchant specific data. You can implement your own scheme for handling merchant tags and categories and related data.</p>

          <h2 id="sdk-reference">SDK Reference</h2>

<p>NimbleCommerce iOS SDK classes are divided to three groups:
* manager classes - singleton classes that provides global access to shared actions and data. SDK contains settings, merchant and authorization managers. Authorization manager is used to perform authorization functions.
* helper classes - container and bean classes that used to perform API requests, present and store received from responses data.
* request classes - wrapper classes that used to perform specific NimbleCommerce API calls.
* beans classes - container objects to keep your data incapsulated</p>

<h3 id="nimblecommerce-ios-sdk-request-classes-description">NimbleCommerce iOS SDK Request Classes Description</h3>

<p>Every request class is used to perform specific NimbleCommerce API call (get deal, save payment account, etc.). Every request class is wrapper around loader class which performs network communication and parses server response. Request classes use block-based and delegation pattern to notify about successful or failed call status. In case of successful response, received data is stored in object fields and can be accessed using object properties. Any detailed description about available actions and structure of NimbleCommerce iOS SDK classes can be found in your merchant portal in Mobile Apps section. Documentation is distributed in .docset format that allows you to import it in Xcode Documentation system.</p>

<h3 id="recommendations">Recommendations</h3>

<p>Loader classes usage remains similar if you use ARC or doesnât. Strong reference on loader object should be saved in field or property to keep loader live while loading routines are in progress. Loader can be created on initialization or can be instantiated lazily on first access to property. Examples for loaders initialization and usage for arc and manual memory management. Note that result blocks of loaders will be released and reset to nil as soon as loader completes, you should set result blocks before every loader execution.</p>

<p>Every loader extends NCLoader class that provides common interface for NimbleCommerce API calls. Every NCLoader has configuration fields described below, that will be set up automatically from managers or can be set up manually to configure loader with specific data.</p>

<p>NCLoader configuration fields:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>userAgent</td>
<td>application user agent, used to identify application on backend.</td>
</tr>
<tr>
<td>apiVersion</td>
<td>NimbleCommerce API version.</td>
</tr>
<tr>
<td>merchantId</td>
<td>merchant identifier.</td>
</tr>
<tr>
<td>secretKey</td>
<td>application secret key.</td>
</tr>
<tr>
<td>localeId</td>
<td>locale identifier.</td>
</tr>
<tr>
<td>authorizationKey</td>
<td>authorization key, used only for API calls that require user authorization.</td>
</tr>
</tbody></table>

<h3 id="framework-contains-list-of-loaders-for-public-api-methods-that-can-be-devided-on-categories">Framework contains list of loaders for public API methods that can be devided on categories:</h3>

<p>Account related request classes:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NCAuthorization</td>
<td>used to authorize user.</td>
</tr>
<tr>
<td>NCAccountSignUp</td>
<td>used to perform new user registration action.</td>
</tr>
<tr>
<td>NCAccountLocaleSet</td>
<td>used to install specific locale to user.</td>
</tr>
<tr>
<td>NCAccountSettingsGet</td>
<td>used to receive usr account specific data.</td>
</tr>
<tr>
<td>NCAccountSettingsSet</td>
<td>used to update user account data.</td>
</tr>
<tr>
<td>NCEmailVerify</td>
<td>used to initiate email verification process.</td>
</tr>
<tr>
<td>NCEventTrack</td>
<td>used to track events.</td>
</tr>
<tr>
<td>NCPasswordRecover</td>
<td>used to initiate password recovery process.</td>
</tr>
<tr>
<td>NCUserDealsList</td>
<td>used to receive list of deals for authorized user.</td>
</tr>
<tr>
<td>NCCouponRedeem</td>
<td>used to redeem specific coupon.</td>
</tr>
<tr>
<td>NCDailyAlertsSubscribe</td>
<td>used to subscribe for category alerts.</td>
</tr>
<tr>
<td>NCOrdersList</td>
<td>used to get orders list for authorized user.</td>
</tr>
<tr>
<td>NCOrderVouchersGet</td>
<td>used to get list of order vouchers for authorized user.</td>
</tr>
<tr>
<td>NCStoreOfferClaim</td>
<td>used to claim store offer.</td>
</tr>
<tr>
<td>NCOrderEmailSend</td>
<td>used to send email with order details.</td>
</tr>
</tbody></table>

<p>Payment accounts related request classes:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NCPaymentAccountDelete</td>
<td>used to delete user payment account.</td>
</tr>
<tr>
<td>NCPaymentAccountGet</td>
<td>used to receive user payment account data.</td>
</tr>
<tr>
<td>NCPaymentAccountSave</td>
<td>used to save or create user payment account.</td>
</tr>
<tr>
<td>NCPaymentAccountSetDefault</td>
<td>used to set default user payment account.</td>
</tr>
<tr>
<td>NCPaymentAccountsList</td>
<td>used to receive user payment accounts list.</td>
</tr>
</tbody></table>

<p>Addresses related request classes:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NCAddressesList</td>
<td>used to receive user addresses list.</td>
</tr>
<tr>
<td>NCAddressSave</td>
<td>used to save/create user address.</td>
</tr>
<tr>
<td>NCAddressValidate</td>
<td>used to validate address data.</td>
</tr>
<tr>
<td>NCAddressDelete</td>
<td>used to delete user address.</td>
</tr>
<tr>
<td>NCAddressSetDefault</td>
<td>used to set user address as default.</td>
</tr>
</tbody></table>

<p>Application related request classes:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NCApplicationSettingsGet</td>
<td>used to receive application settings.</td>
</tr>
<tr>
<td>NCLocaleSettingsGet</td>
<td>used to receive locale specific settings.</td>
</tr>
<tr>
<td>NCMerchantCategoriesGet</td>
<td>used to receive categories list.</td>
</tr>
<tr>
<td>NCMerchantTagsGet</td>
<td>used to receive tags list.</td>
</tr>
</tbody></table>

<p>Push notifications related request classes:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NCPushNotificationDeviceRegister</td>
<td>used to assign push notification device token to specific user.</td>
</tr>
<tr>
<td>NCPushNotificationSettingsGet</td>
<td>used to get push notification alerts settings.</td>
</tr>
<tr>
<td>NCPushNotificationSettingsSet</td>
<td>used to save push notification alerts settings.</td>
</tr>
</tbody></table>

<p>Deal infromation related request classes:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NCClosestCityGet</td>
<td>used to get closest city by geolocation.</td>
</tr>
<tr>
<td>NCClosestDealGet</td>
<td>used to get closest deal by geolocation.</td>
</tr>
<tr>
<td>NCContestDealJoin</td>
<td>used to join contest deal.</td>
</tr>
<tr>
<td>NCDealGet</td>
<td>used to receive specific deal common data.</td>
</tr>
<tr>
<td>NCDealsList</td>
<td>used to receive list of deals.</td>
</tr>
<tr>
<td>NCUserShortDealGet</td>
<td>used to receive user deal data specific to user.</td>
</tr>
<tr>
<td>NCDealShareOptionsGet</td>
<td>used to get deal sharing options.</td>
</tr>
</tbody></table>

<p>Buy request classes:</p>

<table><thead>
<tr>
<th>Class</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NCDealTaxGet</td>
<td>used to calculate deal tax using zip code.</td>
</tr>
<tr>
<td>NCPromoCodeValidate</td>
<td>used to validate and calculate promo code amount using promo code.</td>
</tr>
<tr>
<td>NCGiftCardValidate</td>
<td>used to validate and get gift card balance.</td>
</tr>
<tr>
<td>NCBuyDealGet</td>
<td>used to receive specific deal data sufficient to perform buy action (deprecated, shopping cart methods should be used instead).</td>
</tr>
<tr>
<td>NCDealBuy</td>
<td>used to buy deal(deprecated, shopping cart methods should be used instead).</td>
</tr>
</tbody></table>

          <h1 id="android-sdk">Android SDK</h1>

<p>Welcome to NimbleCommerce Android SDK. Our SDK is a wrapper around NimbleCommerce API which provides native interfaces to communicate with NimbleCommerce platform.
This section has general information and recommendation about SDK usage. Out classes are self-documented, you should study class interface and inline documentation before using any SDK class.</p>

          <h2 id="change-log">Change Log</h2>

<p>NimbleCommerce iOS SDK changes</p>

<h3 id="5-4-00">5.4.00</h3>

<ul>
<li>API version 7 introduced</li>
<li>Sales tax support, additional documentation can be found in Shopping Cart -&gt; Taxes section </li>
<li>Shipping support for offline coupons</li>
<li>Franchise offers support</li>
<li>Multi offer merchant deals support</li>
<li>Merchant opt-ins support</li>
<li>Direct usage of *.nimblecommerce.com endpoints for API access is restricted, *.nimblebuy.com or another FE endpoint should be used instead. SDK will automatically substitute *.nimblecommerce.com with *.nimblebuy.com.</li>
</ul>

          <h2 id="get-started">Get Started</h2>

<h3 id="setting-up-the-the-android-demo-application">Setting Up the the Android Demo Application</h3>

<ul>
<li><p>Required developer tools Android Studio &amp; SDK</p></li>
<li><p>Import gradle project as âImport Projectâ¦â</p></li>
<li><p>There is hierarchy of moduleâs dependencies, project depends on actionbarsherlock-pulltorefresh library by Chris Banes (https://github.com/chrisbanes/ActionBar-PullToRefresh). Library sources included as source files in library directory and compiled as separated project.</p></li>
<li><p>Demo application uses gradle (http://www.gradle.org/) and Android gradle plugin (http://tools.android.com/tech-docs/new-build-system/user-guide ) to perform build and distribution process. Application configuration script is build.gradle located inside SdkApplication module. Script contains dependencies description needed by application and automatically resolves this dependencies by loading necessary files from specified repositories. </p></li>
<li><p>Gradle.properties contains properties for application configuration. Currently it contains set of Google Maps V2 API keys for different build configuration.</p></li>
</ul>

<h3 id="third-party-libraries">Third Party Libraries</h3>

<ul>
<li><p>ActionBar-PullToRefresh - This project aims to provide a reusable Pull to Refresh widget https://github.com/chrisbanes/ActionBar-PullToRefresh. Resolved by gradle dependency on /libraries/actionbarsherlock-pulltorefresh.</p></li>
<li><p>ActionBarSherlock - is an extension of the support library designed to facilitate the use of the action bar design pattern across all versions of Android with a single API. http://actionbarsherlock.com/. Resolved by gradle dependency on android library (com.actionbarsherlock:actionbarsherlock:4.4.0@aar)</p></li>
<li><p>Android-ViewPagerIndicator - paging indicator widgets that are compatible with the ViewPager from the Android Support Library to improve discoverability of content https://github.com/JakeWharton/Android-ViewPagerIndicator. Resolved by gradle dependency on android library (com.viewpagerindicator:library:2.4.1@aar)</p></li>
<li><p>Google play services - required for maps feature integration. Resolved by gradle dependency (com.google.android.gms:play-services:4.1.+)</p></li>
</ul>

<h3 id="merchant-properties">Merchant properties</h3>

<p>File with app configuration for merchant located in /res/raw/app.properties
The file contains the following properties:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>connection.url</td>
<td>merchant site url, required</td>
</tr>
<tr>
<td>connection.merchant</td>
<td>merchant id, required</td>
</tr>
<tr>
<td>connection.locale</td>
<td>merchant locale sites</td>
</tr>
<tr>
<td>connection.port</td>
<td>site port, 80 by default</td>
</tr>
<tr>
<td>connection.sslport</td>
<td>secure site port, 443 by default</td>
</tr>
<tr>
<td>connection.apiVersion</td>
<td>supported api version</td>
</tr>
<tr>
<td>config.country</td>
<td>merchant country code (uses for zip validation)</td>
</tr>
<tr>
<td>config.cookiesDayExpires</td>
<td>days to expires user login data, 60 by default</td>
</tr>
<tr>
<td>config.connTimeout</td>
<td>timeout connection to server API in millis, 60s by default</td>
</tr>
<tr>
<td>config.isShoppingCartEnabled</td>
<td>use shopping cart instead of usual buy page</td>
</tr>
<tr>
<td>config.isFreeOrdersEnabled</td>
<td>support free orders in application</td>
</tr>
<tr>
<td>config.locateStartCity</td>
<td>try to geolocate &amp; select closest city</td>
</tr>
</tbody></table>

<aside class="notice">
Configuration for application locales, represented in connection.locale property
This is an example of how the value should look: 
connection.locale=6:en,256:fr
Where integer values 6, 256 is locale site ids & string values en, fr suffix of values directory for listed locales, e.g. /res/values-en, /res/values-fr.
</aside>

<h3 id="project-structure">Project structure</h3>

<p>Application uses gradle flavour to provide flexible way of constructing multiple application variants. Demo application contains main directory with all sources and resources and BlueDotDeals flavour and overrides AndroidManifest.xml to add google services support for demo application (google maps and cloud messages). API keys and package identifiers will be replaced to actual one by gradle script when gradle sync is done.</p>

<h3 id="creating-additional-flavour">Creating additional flavour</h3>

<p>To develop your own new application, flavour needs to be applied. You can copy BlueDotDeals file structure and gradle settings or just rename the BlueDotDeals file to meet your requirements. Any source code you need to override (has different behavior or needs code customization and enhancement) should be removed from main directory and added to all flavours working directories, note that source directory path should be the same in all flavours (example, /java/src/nc.app/auth/Account.java should have the same path in bluedotdeals folder if you want override Account.java class). </p>

<h3 id="customization">Customization</h3>

<ul>
<li>Application Theme implemented according to Android API Guides (http://developer.android.com/guide/topics/ui/themes.html). </li>
<li>SherlockActionBar customization easy to change with this resource http://jgilfelt.github.com/android-actionbarstylegenerator/</li>
<li>You can also customize the theme manually. It is /res/values/styles.xml includes styles which you can change. Also, as you know, it is possible to change drawable resources, layouts, dimens, etc.</li>
</ul>

          <h2 id="sdk-reference">SDK Reference</h2>

<h3 id="loading-deals">Loading Deals</h3>

<p>This is a simple overview of SDK main components and their usages. To get full understanding of application components and SDK usage please use demo application source code.</p>

<blockquote>
<p>To load deals by different criterias there is gb.android.sdk.Deals async request</p>
</blockquote>
<pre class="highlight java"><code><span class="k">new</span> <span class="nf">Deals</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">params</span><span class="o">)</span>
    <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">Deals</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">GroupBuyList</span> <span class="n">deals</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Do something with deals</span>
            <span class="c1">// put to adapter, increase page, etc.</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Show error</span>
            <span class="c1">// Do some other stuff</span>
        <span class="o">}</span>
    <span class="o">})</span>
    <span class="o">.</span><span class="na">execute</span><span class="o">();</span> 
</code></pre>

<blockquote>
<p>To pass necessary criteria to request there is gb.android.sdk.beans.Params. Filling Params build to setup deals loader</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="n">Params</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">tags</span><span class="o">)</span> <span class="c1">// load deals with specified tags only</span>
<span class="c1">// only specified types</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">Constants</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">DEAL</span><span class="o">,</span> <span class="n">Constants</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">AFFILIATE</span><span class="o">)</span>
<span class="c1">// set up sorting</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">Constants</span><span class="o">.</span><span class="na">Sort</span><span class="o">.</span><span class="na">PUBLISHED_DESC</span><span class="o">,</span> <span class="n">Constants</span><span class="o">.</span><span class="na">Sort</span><span class="o">.</span><span class="na">DISTANCE_ASC</span><span class="o">)</span>            <span class="o">.</span><span class="na">category</span><span class="o">(</span><span class="n">cityId</span><span class="o">)</span> <span class="c1">// current city id</span>
        <span class="o">.</span><span class="na">location</span><span class="o">(</span><span class="n">latitude</span><span class="o">,</span> <span class="n">longitude</span><span class="o">)</span> <span class="c1">// obtained location</span>
        <span class="o">.</span><span class="na">page</span><span class="o">(</span><span class="n">nextPage</span><span class="o">)</span> <span class="c1">// next page to load</span>
        <span class="o">.</span><span class="na">size</span><span class="o">(</span><span class="n">listSize</span><span class="o">)</span> <span class="c1">// deals list size</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>To get cities there is simple call:</p>
</blockquote>
<pre class="highlight java"><code><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">Nmb</span><span class="o">.</span><span class="na">getDealsManager</span><span class="o">().</span><span class="na">getMerchantCategories</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>To get tags everywhere in code just use next listing</p>
</blockquote>
<pre class="highlight java"><code><span class="n">List</span><span class="o">&lt;</span><span class="n">MerchantTag</span><span class="o">&gt;</span> <span class="n">tags</span> <span class="o">=</span> <span class="n">Nmb</span><span class="o">.</span><span class="na">getMerchantManager</span><span class="o">().</span><span class="na">getMerchantTags</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>To authorize SDK to load resources which associated with specific customer should be used next listing, call authorize method in async context.</p>
</blockquote>
<pre class="highlight java"><code><span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">authorize</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
</code></pre>

<blockquote>
<p>To check if SDK has authorization</p>
</blockquote>
<pre class="highlight java"><code><span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">isAuthorized</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>After the successful authorization SDK get Authorization Token with 24 hours expiration. Also keeps in secure storage customer credentials. Call for reauthorization when authorization token expired error code returned</p>
</blockquote>
<pre class="highlight java"><code><span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">reauthorize</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>To completely clear authorization and saved credentials from SDK should be called</p>
</blockquote>
<pre class="highlight java"><code><span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">deauthorize</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>To create new user in the system there is gb.android.sdk.request.SingUpUser async request, pass a valid UserBean to this request.</p>
</blockquote>
<pre class="highlight java"><code><span class="k">new</span> <span class="nf">SignUpUser</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
    <span class="o">.</span><span class="na">user</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
    <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">SignUpUser</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">UserBean</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Do authorize with user.email and user.password</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Show error</span>
            <span class="c1">// Do some other stuff</span>
        <span class="o">}</span>
    <span class="o">})</span>
    <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>To authorize SDK using facebook, should be used listing below. If system has restriction on customer age limit and facebook bean has not the field, dateOfBirth parameter should be passed to method.</p>
</blockquote>
<pre class="highlight java"><code><span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">authorize</span><span class="o">(</span><span class="n">facebook</span><span class="o">,</span> <span class="n">dateOfBirth</span><span class="o">);</span>
</code></pre>

<blockquote>
<p>To get user data there is gb.android.sdk.request.GetUserSettings.</p>
</blockquote>
<pre class="highlight java"><code><span class="k">new</span> <span class="nf">GetUserSettings</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
    <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">GetUserSettings</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">UserBean</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Use user data</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Show error</span>
            <span class="c1">// Do some other stuff</span>
        <span class="o">}</span>
    <span class="o">})</span>
    <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>To get user purchases should be called asynchronously method below:</p>
</blockquote>
<pre class="highlight java"><code><span class="n">GroupBuyList</span> <span class="n">offersList</span> <span class="o">=</span> <span class="n">Nmb</span><span class="o">.</span><span class="na">getDealsManager</span><span class="o">().</span><span class="na">getMyCouponsList</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="n">filter</span><span class="o">);</span>
</code></pre>

<blockquote>
<p>Load free orders (Store Offer)</p>
</blockquote>
<pre class="highlight java"><code><span class="k">new</span> <span class="nf">Orders</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
    <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">filter</span><span class="o">)</span> <span class="c1">// may be available or used</span>
    <span class="o">.</span><span class="na">offset</span><span class="o">(</span><span class="n">offset</span><span class="o">)</span> <span class="c1">// usually page * limit</span>
    <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="n">limit</span><span class="o">)</span> <span class="c1">// size of elements to load</span>
    <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">Orders</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">,</span> <span class="n">Iteger</span> <span class="n">totalCount</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Process orders</span>
            <span class="c1">// Set to adapter</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Show error</span>
            <span class="c1">// Do some other stuff</span>
        <span class="o">}</span>
    <span class="o">})</span>
    <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>Vouchers (for free offers only). Load vouchers for particular order</p>
</blockquote>
<pre class="highlight java"><code><span class="k">new</span> <span class="nf">Vouchers</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">orderId</span><span class="o">(</span><span class="n">orderId</span><span class="o">)</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">Vouchers</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Voucher</span><span class="o">&gt;</span> <span class="n">vouchers</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// render vouchers</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error</span>
                <span class="c1">// Do other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<h3 id="push-notifications">Push Notifications</h3>

<p>To subscribe device to push notifications should add registration and for logged in user only. Use listing below only if SDK has authorization for particular customer. For sure reqistrationId should be obtained in usual way in according to Android Documentation. Also should be implemented receiver and intent service to handle and show notifications, see Documentation and nc.app.GcmIntentService, nc.app.GcmBroadcastReceiver from demo application to get details.</p>

<blockquote>
<p>Register device token on server</p>
</blockquote>
<pre class="highlight java"><code><span class="k">new</span> <span class="nf">RegisterDevice</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
    <span class="o">.</span><span class="na">registrationId</span><span class="o">(</span><span class="n">registrationId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>To unregister device from push notification use listing below</p>
</blockquote>
<pre class="highlight java"><code><span class="k">new</span> <span class="nf">UnregisterDevice</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
    <span class="o">.</span><span class="na">registrationId</span><span class="o">(</span><span class="n">registrationId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<h3 id="shopping-cart">Shopping Cart</h3>

<blockquote>
<p>Add deal to Shopping Cart, just use</p>
</blockquote>
<pre class="highlight java"><code><span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">()</span>
    <span class="o">.</span><span class="na">addItem</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">ShoppingCartItem</span><span class="o">().</span><span class="na">categoryId</span><span class="o">(</span><span class="n">categoryId</span><span class="o">).</span><span class="na">dealId</span><span class="o">(</span><span class="n">dealId</span><span class="o">),</span>
        <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
                <span class="c1">// open Shopping Cart activity</span>
                <span class="c1">// or do some other stuff</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error</span>
                <span class="c1">// if response.getErrorCode() exists</span>
                <span class="c1">// there is no compatible deals</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="n">context</span><span class="o">);</span>
</code></pre>

<blockquote>
<p>To clear Shopping Cart use listing below</p>
</blockquote>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>Perform loading of Shopping Cart details</p>
</blockquote>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">()</span>
        <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
                <span class="c1">// render and do other stuff</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// perform failure stuff</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="n">context</span><span class="o">);</span>
</code></pre>

<blockquote>
<p>Use required information about Shopping Cart and set to view.</p>
</blockquote>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span> <span class="n">shoppingCart</span> <span class="o">=</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">ShoppingCartItem</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="n">shoppingCart</span><span class="o">.</span><span class="na">items</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">ShortDeal</span><span class="o">&gt;</span> <span class="n">deals</span> <span class="o">=</span> <span class="n">shoppingCart</span><span class="o">.</span><span class="na">deals</span><span class="o">();</span>
    <span class="n">BillingSettings</span> <span class="n">billing</span> <span class="o">=</span> <span class="n">shoppingCart</span><span class="o">.</span><span class="na">billingSettings</span><span class="o">();</span>
    <span class="n">BuyOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="n">shoppingCart</span><span class="o">.</span><span class="na">buyOptions</span><span class="o">();</span>
    <span class="n">UserBillingSettings</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">shoppingCart</span><span class="o">.</span><span class="na">userBillingSettings</span><span class="o">();</span>
</code></pre>

<h3 id="deals-offers-attributes-etc">Deals, Offers, Attributes, etc.</h3>

<p>Particular item of gb.android.sdk.cart.ShoppingCartItem contains data related to selected info performed by user like gift information, shipping method, quantity, attributes.
Original data for deals contains in gb.android.sdk.beans.ShortDeal. There are additional  data points related to deal, offers, attributes, shipping, etc.
To render deals to view, you will need to use the following 2 items: (1) original data about deals from ShortDeal and (2) data for selections from ShoppingCartItem.</p>

<h3 id="prices-and-limits">Prices and limits</h3>

<p>Each offer has field âpriceâ which should be applied for calculations.
Be careful with limits, particular customer able to select only allowed limit of deal.</p>

<p><code class="prettyprint">shortOffer.quantity</code> - available quantity to select for the offer
<code class="prettyprint">shortOffer.giftQuantity</code> - available quantity to gift the offer</p>

<p><code class="prettyprint">shortDeal.quantityLimit</code> - available quantity for all child offers
<code class="prettyprint">shortDeal.quantityGiftLimit</code> - available quantity to gift for all child offers</p>

<p>Deal can be gifted only if <code class="prettyprint">shortDeal.options.hasGifting</code> is <code class="prettyprint">TRUE</code>.</p>

<h3 id="tax">Tax</h3>

<blockquote>
<p>If particular deal has option shortDeal.options.hasTax=true additional price for shipping should be calculated. Use listing below to do that:</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">CalculateTaxPercent</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">address</span><span class="o">(</span><span class="n">selectedAddress</span><span class="o">)</span> <span class="c1">// gb.android.sdk.beans.Address</span>
        <span class="o">.</span><span class="na">dealIds</span><span class="o">(</span><span class="n">dealIdList</span><span class="o">)</span> <span class="c1">// all deals that has options.hasTax=true</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">CalculateTaxPercent</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">taxRates</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// taxRates has key as dealId &amp; value as taxAmount</span>
                <span class="c1">// should be applied to price of deal</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error</span>
                <span class="c1">// do some other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<h3 id="shipping-price-deal-amp-offer-level">Shipping Price (Deal &amp; Offer level)</h3>

<p><code class="prettyprint">gb.android.sdk.beans.ShortDeal</code> has optional field <code class="prettyprint">shippingType</code>. If field exists additional price for shipping should be applied for this deal.
To get price: if <code class="prettyprint">shortDeal.shippingType.methods</code> exist use price from particular item which selected by user, if not exist - use <code class="prettyprint">shippingType.price</code></p>

<p>To know what kind of shipping need to apply to deal use <code class="prettyprint">shippingType.pricingType</code>
<code class="prettyprint">PricingType.PER_DEAL</code> - should be applied once for deal
<code class="prettyprint">PricingType.PER_MERCHANT</code> - the same, but if more deals with the same shortDeal.subMerchantId exists should be applied greatest value once.</p>

<p><code class="prettyprint">gb.android.sdk.beans.ShortOffer</code> also has field <code class="prettyprint">shippingType</code>. If field exist additional price for shipping should be applied for this offer.
To get price: if <code class="prettyprint">shortOffer.shippingType.methods</code> exist use price from particular item which selected by user, if not exist - use <code class="prettyprint">shippingType.price</code></p>

<p>To know what kind of shipping need to apply to offer use <code class="prettyprint">shippingType.pricingType</code>
<code class="prettyprint">PricingType.PER_OFFER</code> - should be applied once for this offer, because each offer has own shipping price
<code class="prettyprint">PricingType.PER_ITEM</code> - every offer item should be multiplied on shipping price, so price is <code class="prettyprint">offerPrice * quantity + shippingPrice * quantity</code></p>

<blockquote>
<p>An promotion code available to be applied to order once. To get discount value which will be applied use listing below.</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">PromoCodeAmount</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">dealIds</span><span class="o">(</span><span class="n">dealIdsList</span><span class="o">)</span> <span class="c1">// only shortDeal.options.hasPromoCode=true</span>
        <span class="o">.</span><span class="na">promoCode</span><span class="o">(</span><span class="n">promoCodeString</span><span class="o">)</span> <span class="c1">// promotion code</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">Response</span> <span class="n">promo</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// apply price of promo code</span>
                <span class="c1">// promo.type may be AMOUNT or PERCENT</span>
                <span class="c1">// promo.value is amount to apply</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error, do some other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>One or more gift cards available to apply to order. Use listing below to get information about particular gift card.</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">CheckGiftCard</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">cardNumber</span><span class="o">(</span><span class="n">numberString</span><span class="o">)</span> <span class="c1">// gift card number</span>
        <span class="o">.</span><span class="na">cardPin</span><span class="o">(</span><span class="n">pinString</span><span class="o">)</span> <span class="c1">// gift card pin</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">CheckGiftCard</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">GiftCard</span> <span class="n">giftCard</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// apply gift card amount giftCard.amount</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error, do other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<h3 id="credits">Credits</h3>

<p>If logged in user has credits available this discount may also be applied. 
To get the amount of available credits use <code class="prettyprint">order.userBillingSettings().credits()</code>
Note: credits may be applied only for deals with <code class="prettyprint">shortDeal.options.hasCredits=true</code></p>

<h3 id="addresses">Addresses</h3>

<p>An address should be applied to order if at least one product was added.
If save address feature is enabled for merchant predefined address available to use.</p>

<blockquote>
<p>To get the list of addresses for a logged-in user use the code below:</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">LoadAddresses</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">LoadAddresses</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">LoadAddresses</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// render addresses to list view</span>
                <span class="c1">// List&lt;Address&gt; addresses = response.addresses</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error, do other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>It is possible to also change any address or create new one using listing below.</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">SaveAddress</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">address</span><span class="o">(</span><span class="n">bean</span><span class="o">)</span> <span class="c1">// gb.android.sdk.beans.Address</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">SaveAddress</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Address</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// do some stuff with address</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error, do other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>Delete option also available</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">DeleteAddress</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">addressId</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">DeleteAddress</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// refresh view, etc.</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error, do other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<h3 id="payment-accounts">Payment Accounts</h3>

<p>An credit card and billing information should be applied to order if total amount of order greater than 0. The user should also be able to use their saved credit card, if one is available to use. </p>

<blockquote>
<p>To load saved payment information use listing:</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">LoadPaymentInfos</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">LoadPaymentInfos</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">LoadPaymentInfos</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// render response.paymentInfos</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error, other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>It is also possible to change any payment method information or create a new one using the code below:</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">SavePaymentInfo</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">paymentInfo</span><span class="o">(</span><span class="n">bean</span><span class="o">)</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">SavePaymentInfo</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">SavePaymentInfo</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// use response.paymentAccountId                </span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// show error, do other stuff</span>
            <span class="o">}</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>Delete option also available</p>
</blockquote>
<pre class="highlight java"><code>    <span class="k">new</span> <span class="nf">DeletePaymentAccount</span><span class="p">(</span><span class="n">context</span><span class="o">)</span>
        <span class="o">.</span><span class="na">paymentAccountId</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
        <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">DeletePaymentAccount</span><span class="o">.</span><span class="na">ResultHander</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// update list view</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// show error, do other stuff</span>
    <span class="o">}</span>
    <span class="o">})</span>
    <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<h3 id="order">Order</h3>

<p>Before checkout is completed ShoppingCart.CheckoutInfo this should be created.
This object has fields which represent additional data that should be passed to server API to make complete the proper checkout of the shopping cart. </p>

<p><code class="prettyprint">guestEmail</code> - if SDK does not have authorization and guest checkout enabled for all deals, the field should be passed;
<code class="prettyprint">dateOfBirth</code> - in format MM/dd/yyyy, should be used next listing to know if show: <code class="prettyprint">Nmb.getMerchantManager().isShownField(SIGN_UP, DATE_OF_BIRTH);</code>
<code class="prettyprint">credits</code> - amount of credits which has been applied by the user
<code class="prettyprint">promoCode</code> - string value of promotion code which has been applied by the user
<code class="prettyprint">shippingAddress</code> - <code class="prettyprint">gb.android.sdk.beans.Address</code>, required if Shopping Cart has at least one product or deal card.
<code class="prettyprint">billingInfo</code> - <code class="prettyprint">gb.android.sdk.beans.PaymentInfo</code>, required if the total amount of shopping cart value is greater than 0, if field exist credit card will be charged.
<code class="prettyprint">secureCode</code> - credit card cvv code
<code class="prettyprint">giftCards</code> - list of gb.android.sdk.beans.GiftCardBuyBean, which applied by user</p>

<blockquote>
<p>Finally, to complete checkout just use the listing below :</p>
</blockquote>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">checkout</span><span class="o">(</span><span class="n">checkoutInfo</span><span class="o">,</span> 
            <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
                    <span class="c1">// show confirmation view</span>
                    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// show error, do other stuff</span>
                <span class="o">}</span>
            <span class="o">},</span> <span class="n">context</span><span class="o">);</span>
</code></pre>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">Shell</a>
                <a href="#" data-language-name="objective_c">iOS</a>
                <a href="#" data-language-name="java">Android</a>
          </div>
      </div>
    </div>
  </body>
</html>
