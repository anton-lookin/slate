<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>NimbleCommerce API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell","objective_c","java"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="objective_c">objective_c</a>
              <a href="#" data-language-name="java">java</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://www.nimblecommerce.com'>Copyright Â© 2015 Nimblecommerce</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the NimbleCommerce API! You can use our API to access NimbleCommerce API endpoints.</p>

<p>We have language bindings in Shell, Objective-C for iOS, and Java for Android! You can view code examples in the dark area to the right, and you can switch the programming language of the examples with the tabs in the top right.</p>

<h1 id="authorization">Authorization</h1>

<p>NimbleCommerce SDK requires user authorization for a number of API calls. SDK has implemented authorization scheme which is ready to use in your applications.</p>

<p><strong>iOS</strong></p>

<p><code class="prettyprint">NCAuthorizationManager usage is recommended way to embed user authorization in your application</code></p>

<p><code class="prettyprint">NCAuthorizationManager</code> will automatically handle all authorization routines credentials saving, tokens caching and renewal.</p>

<p><code class="prettyprint">Authorization token and user credentials securely saved in keychain</code></p>

<p>NimbleCommerce SDK gives ability to build your own authorization handling. You should use <code class="prettyprint">NCAuthorization</code> loader to get you authorization token.</p>

<p>To handle result you should register for notifications defined in <code class="prettyprint">NCAuthorizationManager.h</code>. 
<code class="prettyprint">NCAuthorizationManagerAuthorizationCompleted</code> - notification fired when user authorization succeed.
<code class="prettyprint">NCAuthorizationManagerAuthorizationFailed</code> - notification fired when user authorization failed for some reason, error code can be found in notification&rsquo;s userInfo by &lsquo;kNCAuthorizationErrorCode&rsquo; key.
<code class="prettyprint">NCAuthorizationManagerDeauthorizationCompleted</code> - notification fired when user deautorization succeed.</p>

<p><strong>Android</strong></p>

<p><code class="prettyprint">AuthManager</code> usage is recommended way to embed user authorization in your application`</p>

<p><code class="prettyprint">NCAuthorizationManager</code> will automatically handle all authorization routines credentials saving, tokens caching and renewal.</p>

<p><code class="prettyprint">Authorization token and user credentials securely saved in secured preferences</code></p>

<p>Be sure to call &#39;authorize&rsquo; method inside async context, <code class="prettyprint">authorize()</code> is sync method and can throw number of exception, you should handle this manually.
<code class="prettyprint">AuthManager</code> fires couple of local notifications, so you could catch result in different parts of your application.
<code class="prettyprint">LOGIN_EVENT</code> - notification fired when user authorization succeed.
<code class="prettyprint">LOGOUT_EVENT</code> - notification fired when user deauthorization succeed.
<code class="prettyprint">SIGN_UP_EVENT</code> - notification fired when user registration succeed.</p>

<aside class="notice">
Make sure to replace `Authorization Token` with your Authorization Token for all requests that require authorization. If you use managers than this handlings will be done automatically.
</aside>

<h2 id="authorization-with-credentials">Authorization with Credentials</h2>

<p>Received <code class="prettyprint">Authorization Token</code> has limited lifetime but long enough to not mess with reauthorization while application running. 
It is recommended to update token when your application start.</p>

<aside class="notice">
Be sure to do all the secure requests over `https` protocol.
</aside>

<blockquote>
<p>Performs user authorization by login and password.</p>
</blockquote>
<pre class="highlight objective_c"><code><span class="cp">#import &lt;NimbleCommerceSDK/NCAuthorizationManager.h&gt;
</span>
<span class="p">[[</span><span class="n">NCAuthorizationManager</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">authorizeWithEmail</span><span class="p">:</span><span class="n">email</span> <span class="nf">password</span><span class="p">:</span><span class="n">password</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code><span class="kn">import</span> <span class="nn">gb.android.sdk.Nmb</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">gb.android.sdk.managers.AuthManager</span><span class="o">;</span>

<span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">authorize</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"email={USER_EMAIL}&amp;password={USER_PASSWORD}"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 6"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/authorize?merchantId<span class="o">=</span>78
</code></pre>

<h2 id="authorization-with-facebook">Authorization with Facebook</h2>

<p>You should setup application for facebook sign in, receive user data and fill <code class="prettyprint">facebookData</code> bean.
<aside class="notice">
Note, email is mandatory field, so you should setup permission on your facebook application.
</aside></p>

<blockquote>
<p>Performs user authorization with Facebook account.</p>
</blockquote>
<pre class="highlight objective_c"><code><span class="cp">#import &lt;NimbleCommerceSDK/NCAuthorizationManager.h&gt;
</span>
<span class="p">[[</span><span class="n">NCAuthorizationManager</span> <span class="nf">sharedInstance</span><span class="p">]</span> <span class="nf">authorizeWithFacebook</span><span class="p">:</span><span class="n">facebookData</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code><span class="kn">import</span> <span class="nn">gb.android.sdk.Nmb</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">gb.android.sdk.managers.AuthManager</span><span class="o">;</span>

<span class="n">Nmb</span><span class="o">.</span><span class="na">getAuthManager</span><span class="o">().</span><span class="na">authorize</span><span class="o">(</span><span class="n">facebookUserBean</span><span class="o">,</span> <span class="n">mFacebook</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAccessToken</span><span class="o">(),</span> <span class="n">birthDate</span><span class="o">);</span>
</code></pre>

<h1 id="shopping-cart">Shopping Cart</h1>

<p>Shopping Cart API methods use hybrid parameters scheme, shopping cart related parameters are passed in request body as JSON.
NimbleCommerce parameters such as <code class="prettyprint">merchantId</code>, <code class="prettyprint">localeId</code>, <code class="prettyprint">securityKey</code> are passed in URL.
Shopping Cart API uses cookie to save shopping cart basic information.</p>

<aside class="notice">
You should handle shopping cart cookie manually, if you using Shopping Cart API directly.
You can access cookie by name `sc_{MERCHANT_ID}`
</aside>

<h2 id="structure">Structure</h2>

<p>Shopping cart cookie is stored as json and has strict format.
Cookie value saved as percent escaped UTF8 string enclosed with quotes.
Shopping cart can be accessed by decoding cookie value, removing enclosing quotes and parsing json string.
Cookie saves basic shopping cart information about deals that added to cart.</p>

<p>Cookie deal parameters:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>number</td>
<td>deal identifier.</td>
</tr>
<tr>
<td>cId</td>
<td>number</td>
<td>category (city) identifier.</td>
</tr>
<tr>
<td>o</td>
<td>array</td>
<td>array of deal offers.</td>
</tr>
</tbody></table>

<p>Cookie offer parameters:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>number</td>
<td>offer identifier</td>
</tr>
<tr>
<td>q</td>
<td>number</td>
<td>offer selected quantity</td>
</tr>
<tr>
<td>a</td>
<td>array</td>
<td>array of selected offer attributes (map of attributeId -&gt; optionId)</td>
</tr>
</tbody></table>

<aside class="notice">
Decoded cookie value example: "[{&ldquo;id&rdquo;:12312,&ldquo;cId&rdquo;:223,&ldquo;gifted&rdquo;:false,&ldquo;o&rdquo;:[{&ldquo;id&rdquo;:13141,&ldquo;q&rdquo;:1}]},{&ldquo;id&rdquo;:13510,&ldquo;cId&rdquo;:223,&ldquo;o&rdquo;:[{&ldquo;id&rdquo;:14508,&ldquo;q&rdquo;:2,&ldquo;a&rdquo;:[{&ldquo;2316&rdquo;:4753,&ldquo;2318&rdquo;:4759,&ldquo;2317&rdquo;:4758},{&ldquo;2316&rdquo;:4754,&ldquo;2318&rdquo;:4760,&ldquo;2317&rdquo;:4757}]},{&ldquo;id&rdquo;:14509,&ldquo;q&rdquo;:1}]}]"
</aside>

<h2 id="add-item">Add Item</h2>

<blockquote>
<p>Adding item shopping cart</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="n">NCShoppingCartItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartItem</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">item</span><span class="p">.</span><span class="n">dealId</span> <span class="o">=</span> <span class="mi">@2296932</span><span class="p">;</span>
    <span class="n">item</span><span class="p">.</span><span class="n">categoryId</span> <span class="o">=</span> <span class="mi">@25221</span><span class="p">;</span>

    <span class="n">NCShoppingCart</span> <span class="o">*</span><span class="n">cart</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">];</span>
    <span class="p">[</span><span class="n">cart</span> <span class="nf">addItem</span><span class="p">:</span><span class="n">item</span> <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Error
</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Success
</span>        <span class="p">}</span>
    <span class="p">}];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">ShoppingCartItem</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShoppingCartItem</span><span class="o">().</span><span class="na">categoryId</span><span class="o">(</span><span class="mi">25221</span><span class="o">).</span><span class="na">dealId</span><span class="o">(</span><span class="mi">2296932</span><span class="o">);</span>
    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">addItem</span><span class="o">(</span><span class="n">item</span><span class="o">,</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>

        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>

        <span class="o">}</span>
    <span class="o">},</span> <span class="n">getActivity</span><span class="o">());</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X PUT <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">cityId</span><span class="se">\"</span><span class="s2">:25221,</span><span class="se">\"</span><span class="s2">dealId</span><span class="se">\"</span><span class="s2">:2296932,</span><span class="se">\"</span><span class="s2">offers</span><span class="se">\"</span><span class="s2">:[]}"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart?merchantId<span class="o">=</span>78
</code></pre>

<p>Adds item to shopping cart. Parameters sent as json string in request body.</p>

<aside class="notice">
You should use proper content type header for requests with json body `application/json; charset=UTF-8`.
</aside>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealId</td>
<td>number</td>
<td>deal identifier</td>
</tr>
<tr>
<td>cityId</td>
<td>number</td>
<td>category (city) identifier</td>
</tr>
<tr>
<td>offers</td>
<td>array</td>
<td>empty array, will return default offer quantities in result cookie</td>
</tr>
</tbody></table>

<h2 id="remove-item">Remove Item</h2>

<blockquote>
<p>Removes item from shopping cart</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="p">[[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">]</span> <span class="nf">removeItem</span><span class="p">:</span><span class="mi">@2296932</span><span class="p">];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">removeItem</span><span class="o">(</span><span class="mi">2296932</span><span class="o">);</span>
</code></pre>

<p>Removing shopping cart item does not require network calls. 
You should remove deal object from cookie and sync your UI code.</p>

<h2 id="load-details">Load Details</h2>

<blockquote>
<p>Loads shopping cart details.</p>
</blockquote>
<pre class="highlight objective_c"><code>    <span class="p">[[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">]</span> <span class="nf">load</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Handle error
</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Handle results and update UI
</span>        <span class="p">}</span>
    <span class="p">}];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">shoppingCart</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">// Handle results and update UI</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle error</span>
        <span class="o">},</span> <span class="k">this</span><span class="o">);</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X GET <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart?merchantId<span class="o">=</span>78
</code></pre>

<blockquote>
<p>Shopping cart details json</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"dealsOrder"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"dealId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2296932</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cityId"</span><span class="p">:</span><span class="w"> </span><span class="mi">25221</span><span class="p">,</span><span class="w">
      </span><span class="nt">"isGift"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nt">"offers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"offerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2970562</span><span class="p">,</span><span class="w">
          </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"deals"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2296932</span><span class="p">,</span><span class="w">
      </span><span class="nt">"shortTitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Product Group Offer inc tax"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"endDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"07/31/2015"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PRODUCT"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"subMerchantId"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
      </span><span class="nt">"quantityLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="nt">"quantityGiftLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LIVE"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"image"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Product Group Offer inc tax"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://s3.amazonaws.com/shop_note_stage/nimblebuy/product-group-offer-inc-tax-4302642-regular.jpg"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"offers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2970562</span><span class="p">,</span><span class="w">
          </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Product Group Offer inc tax"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"shortTitle"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
          </span><span class="nt">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
          </span><span class="nt">"giftQuantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
          </span><span class="nt">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">50.0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

          </span><span class="p">],</span><span class="w">
          </span><span class="nt">"shipping"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ITEM"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"methods"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">29312</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FedEx-Next Day"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1 Day"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">20.0</span><span class="w">
              </span><span class="p">},</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">29322</span><span class="p">,</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FedEx-Ground"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5-7 Days"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.0</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nt">"isLive"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"hasTax"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasGifting"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasCredits"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasPromoCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasGuestCheckout"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hasShipping"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"merchants"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dave's photo"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"taxSettings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">6002</span><span class="p">,</span><span class="w">
        </span><span class="nt">"gbId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2296932</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyToShipping"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyToCredits"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyToPromoCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyToGift"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"includeToPrice"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"grossType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TOTAL_GROSS"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"taxKeeper"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SUB_MERCHANT"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"addressToUse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORIGIN_ADDRESS"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"originAddress"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2829 mission st"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"San Francisco"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"California"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"94110"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"fullAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2829 mission st"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"joinedAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2829 mission st"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"taxRuleSetId"</span><span class="p">:</span><span class="w"> </span><span class="mi">1222</span><span class="p">,</span><span class="w">
        </span><span class="nt">"applyTaxesNotNeededForSomeVirtualMoney"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"hasDiscountProgram"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasCredits"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasPromoCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasGiftCard"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasGiftCardPin"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasAddressSave"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasAddressVerification"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasCardlinking"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasRequiredCardlinking"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasRaf"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasShipping"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasGuestCheckout"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"localeShortName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"priceFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$####.##"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datePattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MM/dd/yyyy"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"timePattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HH:mm:ss"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"currentCountry"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"msToExpire"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400000</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"billing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OnlineMart"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"has3dSecure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hasRedirect"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"has1ClickBuy"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"secondaryTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"creditCardTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Visa"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"visa"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4[0-9]{12}(?:[0-9]{3})?$"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Master Card"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"master_card"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^5[1-5][0-9]{14}$"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Discover"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"discover"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6(011|5[0-9]{2})[0-9]{12}$"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Amex"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amex"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3[47][0-9]{13}$"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"creditCardFee"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Shopping cart details loading requires cookie to be set in request. 
As result you&rsquo;ll get details to show shopping cart UI to user and proceed with checkout process.
Results can be accesses as properties in Shoppint Cart singletones on iOS/Android SDKs, this classes have identical to JSON structure.</p>

<p><em>Result JSON values:</em></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealsOrder</td>
<td>object</td>
<td>order in JSON format, will represent cookie value</td>
</tr>
<tr>
<td>deals</td>
<td>array</td>
<td>list of deal details</td>
</tr>
<tr>
<td>options</td>
<td>object</td>
<td>set of shopping cart options, flags that presents different NimbleCommerce features</td>
</tr>
<tr>
<td>settings</td>
<td>object</td>
<td>overall shopping cart settings</td>
</tr>
<tr>
<td>billing</td>
<td>object</td>
<td>shopping cart billing settings</td>
</tr>
</tbody></table>

<h2 id="promo-codes">Promo codes</h2>

<blockquote>
<p>Loads promo code information</p>
</blockquote>
<pre class="highlight objective_c"><code>
    <span class="c1">// NOTE, You should keep strong reference to the loaders
</span>    <span class="n">self</span><span class="p">.</span><span class="n">promoCodeLoader</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCPromoCodeValidate</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">promoCodeLoader</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">promoCodeLoader</span> <span class="nf">validatePromoCode</span><span class="p">:</span><span class="s">@"111111"</span> <span class="nf">deals</span><span class="p">:@[</span><span class="mi">@2296932</span><span class="p">]];</span>

    <span class="c1">// Implement delegated methods and process result.
</span>    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">promoCodeValidationSucceed</span><span class="p">:(</span><span class="n">NCPromoCodeValidate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">promoCodeValidationFailed</span><span class="p">:(</span><span class="n">NCPromoCodeValidate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="nf">withError</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span> <span class="p">{</span>
    <span class="p">}</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">ResultHandler</span> <span class="n">resultHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle success</span>
            <span class="o">}</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">PromoCodeAmount</span><span class="o">.</span><span class="na">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handler error</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="k">new</span> <span class="n">PromoCodeAmount</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
                <span class="o">.</span><span class="na">dealIds</span><span class="o">(</span><span class="n">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="mi">2296932</span><span class="o">))</span>
                <span class="o">.</span><span class="na">promoCode</span><span class="o">(</span><span class="s">"111111"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="n">resultHandler</span><span class="o">)</span>
                <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
        <span class="o">}</span>
</code></pre>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">number</span><span class="se">\"</span><span class="s2">:111111,</span><span class="se">\"</span><span class="s2">dealIds</span><span class="se">\"</span><span class="s2">:"</span>2296932<span class="s2">"}"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart/calculate?merchantId<span class="o">=</span>78<span class="se">\&amp;</span><span class="nb">type</span><span class="o">=</span>PROMO_CODE
</code></pre>

<blockquote>
<p>Result JSON</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">1234.0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AMOUNT"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dealIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="mi">2296932</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Loads promo code value for applicable deals. Will return array with deal identifiers that can apply promo code.</p>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>number</td>
<td>string</td>
<td>promo code number</td>
</tr>
<tr>
<td>dealIds</td>
<td>string</td>
<td>deals identifiers comma separated string</td>
</tr>
</tbody></table>

<p><em>Result JSON values:</em></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>number</td>
<td>promo code amount, can represent percent value</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>promo code type, <code class="prettyprint">AMOUNT</code> or <code class="prettyprint">PERCENT</code></td>
</tr>
<tr>
<td>dealIds</td>
<td>array</td>
<td>list of applicable deals</td>
</tr>
</tbody></table>

<h2 id="gift-cards">Gift cards</h2>

<blockquote>
<p>Loads gift card information</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">number</span><span class="se">\"</span><span class="s2">:62035,</span><span class="se">\"</span><span class="s2">pin</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"\"</span><span class="s2">}"</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: {AUTHORIZATION_TOKEN}"</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart/calculate?merchantId<span class="o">=</span>78<span class="se">\&amp;</span><span class="nb">type</span><span class="o">=</span>GIFT_CARD
</code></pre>
<pre class="highlight objective_c"><code>
    <span class="c1">// NOTE, You should keep strong references to the loaders
</span>    <span class="n">self</span><span class="p">.</span><span class="n">giftCardValidator</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCGiftCardValidate</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">giftCardValidator</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">giftCardValidator</span> <span class="nf">validateGiftCard</span><span class="p">:</span><span class="s">@"62035"</span> <span class="nf">pinCode</span><span class="p">:</span><span class="s">@""</span><span class="p">];</span>

    <span class="c1">// Implement delegated methods and process result.
</span>    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">giftCardValidationSucceed</span><span class="p">:(</span><span class="n">NCGiftCardValidate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">giftCardValidateFailed</span><span class="p">:(</span><span class="n">NCGiftCardValidate</span> <span class="o">*</span><span class="p">)</span><span class="nv">dataSource</span> <span class="nf">withError</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span> <span class="p">{</span>
    <span class="p">}</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">CheckGiftCard</span><span class="o">.</span><span class="na">ResultHandler</span> <span class="n">resultHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CheckGiftCard</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">GiftCard</span> <span class="n">giftCard</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle success   </span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle error</span>
        <span class="o">}</span>
        <span class="k">new</span> <span class="n">CheckGiftCard</span><span class="o">(</span><span class="n">getActivity</span><span class="o">())</span>
                <span class="o">.</span><span class="na">cardNumber</span><span class="o">(</span><span class="s">"62035"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">cardPin</span><span class="o">(</span><span class="s">""</span><span class="o">)</span>
                <span class="o">.</span><span class="na">resultHandler</span><span class="o">(</span><span class="n">resultHandler</span><span class="o">)</span>
                <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</code></pre>

<blockquote>
<p>Result JSON</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">10.0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Checks gift card balance. Returns amount of available credits on gift card.</p>

<aside class="notice">
Authorization required for this call, you should put valid `Authorization Token` into request headers.
</aside>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>number</td>
<td>string</td>
<td>gift card number</td>
</tr>
<tr>
<td>pin</td>
<td>string</td>
<td>gift card pin code</td>
</tr>
</tbody></table>

<p><em>Result JSON values:</em></p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>number</td>
<td>gift card available balance</td>
</tr>
</tbody></table>

<h2 id="taxes">Taxes</h2>

<blockquote>
<p>Loads tax amounts for shopping cart</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s1">'{"shippingAddress":{"address":"sdflsjdklf","address2":"sjdfkjsdkfj","firstName":"laksdjflksdjf","city":"sdjfksdjfk","phone":"28348902384","zip":"90210","countryCode":"US","state":"California","lastName":"lksdjfklsdjfkl"},"dealsOrder":[{"dealId":2296952,"cityId":25221,"offers":[{"offerId":2970592,"count":1,"shippingMethodId":29352}]}]}'</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: {AUTHORIZATION_TOKEN}"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart/calculateTaxAmount?merchantId<span class="o">=</span>78
</code></pre>
<pre class="highlight objective_c"><code>    <span class="n">NCShoppingCartOrderDiscounts</span> <span class="o">*</span><span class="n">discounts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartOrderDiscounts</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">promoCode</span> <span class="o">=</span> <span class="p">{</span><span class="n">PROMO_CODE</span><span class="p">};</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">giftCards</span> <span class="o">=</span> <span class="p">{</span><span class="n">GIFT_CARDS</span><span class="p">};</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">credits</span> <span class="o">=</span> <span class="p">{</span><span class="n">USED_CREDITS</span><span class="p">};</span>

    <span class="n">NCShoppingCartOrderInfo</span> <span class="o">*</span><span class="n">orderInfo</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartOrderInfo</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">discounts</span> <span class="o">=</span> <span class="n">discounts</span><span class="p">;</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">shippingAddress</span> <span class="o">=</span> <span class="p">{</span><span class="n">SHIPPING_ADDRESS</span><span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">isCardless</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">paymentAccount</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">paymentInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCShoppingCartPaymentInfo</span> <span class="nf">paymentInfoFromPaymentAccount</span><span class="p">:</span><span class="n">paymentAccount</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">billingAddress</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">billingAddress</span> <span class="o">=</span> <span class="n">billingAddress</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hasBillingTaxes</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">taxAddress</span> <span class="o">=</span> <span class="n">taxAddress</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">]</span> <span class="nf">loadTaxAmountsWithOrderInfo</span><span class="p">:</span><span class="n">orderInfo</span>
                                               <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="n">NSArray</span> <span class="o">*</span><span class="n">taxAmounts</span><span class="p">)</span> <span class="p">{</span>
                                                   <span class="c1">// Handle results
</span>                                               <span class="p">}];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderInfo</span> <span class="n">orderInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderInfo</span><span class="o">();</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">promoCode</span><span class="o">(</span><span class="n">promoCode</span><span class="o">);</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">giftCards</span><span class="o">(</span><span class="n">giftCards</span><span class="o">());</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">credits</span><span class="o">(</span><span class="n">creditsUsed</span><span class="o">());</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">isCardless</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderInfo</span><span class="o">.</span><span class="na">taxAddress</span><span class="o">(</span><span class="n">taxAddress</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">paymentInfo</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">orderInfo</span><span class="o">.</span><span class="na">paymentInfo</span><span class="o">(</span><span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderPaymentInfo</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">paymentInfo</span><span class="o">()));</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">paymentInfo</span><span class="o">.</span><span class="na">paymentAccountId</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">orderInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">(</span><span class="n">paymentInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">shippingAddress</span><span class="o">(</span><span class="n">shippingAddress</span><span class="o">);</span>
    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">loadTaxAmounts</span><span class="o">(</span><span class="n">orderInfo</span><span class="o">,</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">// Handle success</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle error</span>
        <span class="o">},</span> <span class="n">getActivity</span><span class="o">());</span>
</code></pre>

<blockquote>
<p>Result JSON</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"offersTaxData"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"offerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2970592</span><span class="p">,</span><span class="w">
      </span><span class="nt">"gbId"</span><span class="p">:</span><span class="w"> </span><span class="mi">2296952</span><span class="p">,</span><span class="w">
      </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">6.30</span><span class="p">,</span><span class="w">
      </span><span class="nt">"includedToPrice"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nt">"taxEnabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"canPayTaxesWithCredits"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"canPayTaxesWithPromoCode"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nt">"canPayTaxesWithGiftCards"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealsOrder</td>
<td>array</td>
<td>array of deals in shopping cart</td>
</tr>
<tr>
<td>discounts</td>
<td>object</td>
<td>map of used discounts for shopping cart (credits, gift cards and promo code)</td>
</tr>
<tr>
<td>shippingAddress</td>
<td>object</td>
<td>shipping address, can be used only for passing saved address identifier (if you have one), this will retrieve shipping address from saved address in your account (requires authorization).</td>
</tr>
<tr>
<td>billingAddress</td>
<td>object</td>
<td>address used for billing</td>
</tr>
<tr>
<td>paymentInfo</td>
<td>object</td>
<td>should be used only for passing payment account identifier (requires authorization), this will retrieve billing address from saved payment account in your account</td>
</tr>
<tr>
<td>taxAddress</td>
<td>object</td>
<td>address for tax calculations, should be used only when tax calculations are based on billing information and no billing needed for shopping cart (case when total value is fully covered with credits, purchase without payment)</td>
</tr>
</tbody></table>

<aside class="warning">
Load tax method does not send directly any credit card related information. Billing address should contain only address fields. You can only send payment account identifier in `paymentInfo` to get billing address from previously saved payment account.
</aside>

<aside class="notice">
You should never call this method via `http` protocol, use `https` for all Shopping Cart API calls.
</aside>

<p><strong>Triggering tax amounts loading:</strong></p>

<p>When you load shopping cart details you got <code class="prettyprint">taxSettings</code> object for every deal object. 
If taxes enabled for specific deal than you should trigger tax amount calculation at a certain time and <code class="prettyprint">taxSettings</code> object will help you find out in which one.
In addition to all the other fields <code class="prettyprint">taxSettings</code> contain <code class="prettyprint">addressToUse</code> property which shows what changes will trigger tax amounts loading.</p>

<aside class="notice">
It is recommended to do tax amount loading in async tasks on actions that affects total value (offers quantity change, shipping methods change, applying discounts etc) and on specific tax triggers described above.
</aside>

<p><em><code class="prettyprint">addressToUse</code> values:</em></p>

<table><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ORIGIN_ADDRESS</td>
<td>tax amount calculation is based on shipping address</td>
</tr>
<tr>
<td>CUSTOMERS_BILLING_ADDRESS</td>
<td>tax amount calculation is based on shipping address</td>
</tr>
<tr>
<td>SUB_MERCHANT_LOCATION</td>
<td>tax amount calculation is based on submerchant location, this type of taxes will be triggered when user selects merchant location attribute (will have <code class="prettyprint">isLocation</code> flag from API version 7), if no location attributes available for deal than you should load tax once for deal after shopping cart loaded.</td>
</tr>
<tr>
<td>PREDEFINED_STATE</td>
<td>tax amount calculation is based on predefined state, this value is predefined on backend, you should load tax once for deal after shopping cart loaded.</td>
</tr>
</tbody></table>

<p><strong>Handling results:</strong></p>

<p>As a result of loading you&rsquo;ll get array with tax amounts objects which will help you calculate totals of your shopping cart and complete preparing for checkout.
You should include received amounts to shopping cart calculations as additional amount of money to pay.</p>

<p><em>Tax amount object values:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>gbId</td>
<td>number</td>
<td>deal identifier</td>
</tr>
<tr>
<td>offerId</td>
<td>number</td>
<td>offer identifier</td>
</tr>
<tr>
<td>amount</td>
<td>number</td>
<td>value of taxes calculated for the deal</td>
</tr>
<tr>
<td>includedToPrice</td>
<td>boolean</td>
<td>flag indicates that tax value is already included to offer price and should not be added to shopping cart total.</td>
</tr>
<tr>
<td>canPayTaxesWithCredits</td>
<td>boolean</td>
<td>currently ignored, always true</td>
</tr>
<tr>
<td>canPayTaxesWithGiftCards</td>
<td>boolean</td>
<td>currently ignored, always true</td>
</tr>
<tr>
<td>canPayTaxesWithPromoCode</td>
<td>boolean</td>
<td>currently ignored, always true</td>
</tr>
</tbody></table>

<h2 id="checkout">Checkout</h2>

<p>Shopping cart checkout is fully handled by ShoppingCart singletons. 
You should fill <code class="prettyprint">OrderInfo</code> bean with your shopping cart details and call checkout method of <code class="prettyprint">ShoppingCart</code>.
Shopping cart checkout is highly critical process, you should do all the possible validation checks before completing purchase.</p>

<blockquote>
<p>Performs shopping cart checkout</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X POST <span class="se">\</span>
    -d <span class="s1">'{"dealsOrder":[{"dealId":2296952,"cityId":25221,"offers":[{"offerId":2970592,"count":1,"shippingMethodId":29352}]}],"shippingAddress":{"address":"Main street 1","address2":"","firstName":"First","city":"Beverly Hills","phone":"555-555555","zip":"90210","countryCode":"US","state":"California","lastName":"Last"},"billingAddress":{"address":"Main street 1","address2":"","firstName":"First","city":"Beverly Hills","phone":"555-555555","zip":"90210","countryCode":"US","state":"California","lastName":"Last"},"guestEmail":"test@user.com","paymentInfo":{"cardType":"visa","secureCode":"123","firstName":"First","cardNumber":"4111111111111111","expirationMonth":2,"expirationYear":2017,"lastName":"Last"}}'</span> <span class="se">\</span>
    -H <span class="s2">"x-nimblecommerce-api-version: 7"</span> <span class="se">\</span>
    -H <span class="s2">"Authorization: {AUTHORIZATION_TOKEN}"</span> <span class="se">\</span>
    -H <span class="s2">"Accept: application/json; charset=UTF-8"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json; charset=UTF-8"</span> <span class="se">\</span>
    https://stage.nimblebuy.com/api/shoppingCart/makeBuy?merchantId<span class="o">=</span>78
</code></pre>
<pre class="highlight objective_c"><code>    <span class="n">NCShoppingCartOrderDiscounts</span> <span class="o">*</span><span class="n">discounts</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartOrderDiscounts</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">promoCode</span> <span class="o">=</span> <span class="p">{</span><span class="n">PROMO_CODE</span><span class="p">};</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">giftCards</span> <span class="o">=</span> <span class="p">{</span><span class="n">GIFT_CARDS</span><span class="p">};</span>
    <span class="n">discounts</span><span class="p">.</span><span class="n">credits</span> <span class="o">=</span> <span class="p">{</span><span class="n">USED_CREDITS</span><span class="p">};</span>

    <span class="n">NCShoppingCartOrderInfo</span> <span class="o">*</span><span class="n">orderInfo</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NCShoppingCartOrderInfo</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">discounts</span> <span class="o">=</span> <span class="n">discounts</span><span class="p">;</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">guestEmail</span> <span class="o">=</span> <span class="p">{</span><span class="n">GUEST_EMAIL</span><span class="p">};</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">birthDate</span> <span class="o">=</span> <span class="p">{</span><span class="n">BIRTH_DATE</span><span class="p">};</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">merchantOptIns</span> <span class="o">=</span> <span class="p">{</span><span class="n">MERCHANT_OPT_INS</span><span class="p">};</span>
    <span class="n">orderInfo</span><span class="p">.</span><span class="n">shippingAddress</span> <span class="o">=</span> <span class="p">{</span><span class="n">SHIPPING_ADDRESS</span><span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">isCardless</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">paymentAccount</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">paymentInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCShoppingCartPaymentInfo</span> <span class="nf">paymentInfoFromPaymentAccount</span><span class="p">:</span><span class="n">paymentAccount</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">billingInfo</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">paymentInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCShoppingCartPaymentInfo</span> <span class="nf">paymentInfoFromBillingInfo</span><span class="p">:</span><span class="n">billingInfo</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">orderInfo</span><span class="p">.</span><span class="n">paymentInfo</span><span class="p">.</span><span class="n">cardCVV</span> <span class="o">=</span> <span class="n">secureCode</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hasBillingTaxes</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">orderInfo</span><span class="p">.</span><span class="n">taxAddress</span> <span class="o">=</span> <span class="n">taxAddress</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">NCShoppingCart</span> <span class="nf">cart</span><span class="p">]</span> <span class="nf">checkoutWithOrderInfo</span><span class="p">:</span><span class="n">orderInfo</span> <span class="nf">handler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Handle error
</span>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// Handle success
</span>            <span class="p">}</span>
        <span class="p">}];</span>
</code></pre>
<pre class="highlight java"><code>    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderInfo</span> <span class="n">orderInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderInfo</span><span class="o">();</span>

    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">promoCode</span><span class="o">({</span><span class="n">PROMO_CODE</span><span class="o">});</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">giftCards</span><span class="o">({</span><span class="n">GIFT_CARDS</span><span class="o">});</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">discounts</span><span class="o">().</span><span class="na">credits</span><span class="o">({</span><span class="n">USED_CREDITS</span><span class="o">});</span>

    <span class="n">orderInfo</span><span class="o">.</span><span class="na">guestEmail</span><span class="o">({</span><span class="n">GEUEST_EMAIL</span><span class="o">});</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">dateOfBirth</span><span class="o">({</span><span class="n">BIRTH_DATE</span><span class="o">});</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">merchantOptIns</span><span class="o">({</span><span class="n">MERCHANT_OPT_INS</span><span class="o">});</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">isCardless</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">orderInfo</span><span class="o">.</span><span class="na">taxAddress</span><span class="o">(</span><span class="n">taxAddress</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">paymentInfo</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">orderInfo</span><span class="o">.</span><span class="na">paymentInfo</span><span class="o">(</span><span class="n">ShoppingCart</span><span class="o">.</span><span class="na">OrderPaymentInfo</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">paymentInfo</span><span class="o">));</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">paymentInfo</span><span class="o">.</span><span class="na">paymentAccountId</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">orderInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">(</span><span class="n">paymentInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">billingInfo</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">billingInfo</span><span class="o">.</span><span class="na">id</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">orderInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">(</span><span class="n">billingInfo</span><span class="o">.</span><span class="na">billingAddress</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="n">orderInfo</span><span class="o">.</span><span class="na">paymentInfo</span><span class="o">(</span><span class="n">OrderPaymentInfo</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">billingInfo</span><span class="o">));</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">secureCode</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">orderInfo</span><span class="o">.</span><span class="na">paymentInfo</span><span class="o">().</span><span class="na">cardCVV</span><span class="o">(</span><span class="n">secureCode</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">orderInfo</span><span class="o">.</span><span class="na">shippingAddress</span><span class="o">(</span><span class="n">shippingAddress</span><span class="o">);</span>
    <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">loadTaxAmounts</span><span class="o">(</span><span class="n">orderInfo</span><span class="o">,</span> <span class="k">new</span> <span class="n">ShoppingCart</span><span class="o">.</span><span class="na">ResultHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">// Handle success</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onFailure</span><span class="o">(</span><span class="n">NCResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Handle error</span>
        <span class="o">},</span> <span class="n">getActivity</span><span class="o">());</span>
</code></pre>

<blockquote>
<p>Result JSON</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">71856942</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><em>Request body JSON parameters:</em></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dealsOrder</td>
<td>array</td>
<td>array of deals in shopping cart</td>
</tr>
<tr>
<td>discounts</td>
<td>object</td>
<td>map of used discounts for shopping cart (credits, gift cards and promo code)</td>
</tr>
<tr>
<td>shippingAddress</td>
<td>object</td>
<td>shipping address, can be used only for passing saved address identifier (if you have one), this will retrieve shipping address from saved address in your account (requires authorization).</td>
</tr>
<tr>
<td>billingAddress</td>
<td>object</td>
<td>address used for billing</td>
</tr>
<tr>
<td>paymentInfo</td>
<td>object</td>
<td>payment account id or full credit card information, credit card CVV is required for checkout.</td>
</tr>
<tr>
<td>taxAddress</td>
<td>object</td>
<td>address for tax calculations, should be used only when tax calculations are based on billing information and no billing needed for shopping cart (case when total value is fully covered with discounts, purchase without payment)</td>
</tr>
<tr>
<td>guestEmail</td>
<td>string</td>
<td>email for guest checkout, can&rsquo;t use saved payment accounts or addresses, full credit card information is required if purchase is not cardless (fully covered with discounts).</td>
</tr>
<tr>
<td>dateOfBirth</td>
<td>string</td>
<td><code class="prettyprint">en_US_POSIX</code> string with user birth date, optional field, should be filled if required.</td>
</tr>
<tr>
<td>merchantOptIns</td>
<td>array</td>
<td>list of merchant opt ins</td>
</tr>
</tbody></table>

<aside class="notice">
You should never call this method via `http` protocol, use `https` for all Shopping Cart API calls.
</aside>

<aside class="warning">
You should not store any payment related information on client side.
</aside>

          <h1 id="errors">Errors</h1>

<p>The NimbleCommerce API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; The request could not be understood by the server due to malformed syntax.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; The request requires user authentication. The response MUST include a Authorization header field with valid authorization token.</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The request was a legal request, but the server is refusing to respond to it. Error code for user not authorized to perform the operation or the resource is unavailable for some reason.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The server has not found anything matching the Request-URI.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; The method specified in the Request-Line is not allowed for the resource identified by the Request-URI.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; The resource identified by the request is only capable of generating response entities which have content characteristics not acceptable according to the accept headers sent in the request.</td>
</tr>
<tr>
<td>410</td>
<td>Gone &ndash; The requested resource is no longer available at the server and no forwarding address is known.</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>502</td>
<td>Bad Gateway &ndash; The server was acting as a gateway or proxy and received an invalid response from the upstream server.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="objective_c">objective_c</a>
                <a href="#" data-language-name="java">java</a>
          </div>
      </div>
    </div>
  </body>
</html>
